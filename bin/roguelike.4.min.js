!function(){requirejs.config({waitSeconds:60,paths:{rot:"../lib/rot.js/rot",lodash:"../lib/lodash/lodash"},shim:{phaser:{exports:"Phaser"}}}),define("config",function(){});var a={isSupported:function(){return!!document.createElement("canvas").getContext&&!!Function.prototype.bind},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:25,DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};a.Text={RE_COLORS:/%([bc]){([^}]*)}/g,TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(a,b){for(var c={width:0,height:1},d=this.tokenize(a,b),e=0,f=0;f<d.length;f++){var g=d[f];switch(g.type){case this.TYPE_TEXT:e+=g.value.length;break;case this.TYPE_NEWLINE:c.height++,c.width=Math.max(c.width,e),e=0}}return c.width=Math.max(c.width,e),c},tokenize:function(b,c){var d=[],e=0;b.replace(this.RE_COLORS,function(c,f,g,h){var i=b.substring(e,h);return i.length&&d.push({type:a.Text.TYPE_TEXT,value:i}),d.push({type:"c"==f?a.Text.TYPE_FG:a.Text.TYPE_BG,value:g.trim()}),e=h+c.length,""});var f=b.substring(e);return f.length&&d.push({type:a.Text.TYPE_TEXT,value:f}),this._breakLines(d,c)},_breakLines:function(b,c){c||(c=1/0);for(var d=0,e=0,f=-1;d<b.length;){var g=b[d];if(g.type==a.Text.TYPE_NEWLINE&&(e=0,f=-1),g.type==a.Text.TYPE_TEXT){for(;0==e&&" "==g.value.charAt(0);)g.value=g.value.substring(1);var h=g.value.indexOf("\n");if(-1!=h){g.value=this._breakInsideToken(b,d,h,!0);for(var i=g.value.split("");" "==i[i.length-1];)i.pop();g.value=i.join("")}if(g.value.length){if(e+g.value.length>c){for(var h=-1;;){var j=g.value.indexOf(" ",h+1);if(-1==j)break;if(e+j>c)break;h=j}if(-1!=h)g.value=this._breakInsideToken(b,d,h,!0);else if(-1!=f){var g=b[f],k=g.value.lastIndexOf(" ");g.value=this._breakInsideToken(b,f,k,!0),d=f}else g.value=this._breakInsideToken(b,d,c-e,!1)}else e+=g.value.length,-1!=g.value.indexOf(" ")&&(f=d);d++}else b.splice(d,1)}else d++}b.push({type:a.Text.TYPE_NEWLINE});for(var l=null,d=0;d<b.length;d++){var g=b[d];switch(g.type){case a.Text.TYPE_TEXT:l=g;break;case a.Text.TYPE_NEWLINE:if(l){for(var i=l.value.split("");" "==i[i.length-1];)i.pop();l.value=i.join("")}l=null}}return b.pop(),b},_breakInsideToken:function(b,c,d,e){var f={type:a.Text.TYPE_NEWLINE},g={type:a.Text.TYPE_TEXT,value:b[c].value.substring(d+(e?1:0))};return b.splice(c+1,0,f,g),b[c].value.substring(0,d)}},Array.prototype.random=function(){return this.length?this[Math.floor(a.RNG.getUniform()*this.length)]:null},Array.prototype.randomize=function(){for(var a=[];this.length;){var b=this.indexOf(this.random());a.push(this.splice(b,1)[0])}return a},Number.prototype.mod=function(a){return(this%a+a)%a},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1)},String.prototype.lpad=function(a,b){for(var c=a||"0",d=b||2,e="";e.length<d-this.length;)e+=c;return e=e.substring(0,d-this.length),e+this},String.prototype.rpad=function(a,b){for(var c=a||"0",d=b||2,e="";e.length<d-this.length;)e+=c;return e=e.substring(0,d-this.length),this+e},String.format=function(a){var b=String.format.map,c=Array.prototype.slice.call(arguments,1),d=function(d,e,f,g){if("%"==a.charAt(g-1))return d.substring(1);if(!c.length)return d;var h=c[0],i=e||f,j=i.split(","),k=j.shift(),l=b[k.toLowerCase()];if(!l)return d;var h=c.shift(),m=h[l].apply(h,j),n=k.charAt(0);return n!=n.toLowerCase()&&(m=m.capitalize()),m};return a.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,d)},String.format.map={s:"toString"},String.prototype.format=function(){var a=Array.prototype.slice.call(arguments);return a.unshift(this),String.format.apply(String,a)},Object.create||(Object.create=function(a){var b=function(){};return b.prototype=a,new b}),Function.prototype.extend=function(a){return this.prototype=Object.create(a.prototype),this.prototype.constructor=this,this},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return clearTimeout(a)},a.Display=function(b){var c=document.createElement("canvas");this._context=c.getContext("2d"),this._data={},this._dirty=!1,this._options={},this._backend=null;var d={width:a.DEFAULT_WIDTH,height:a.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null};for(var e in b)d[e]=b[e];this.setOptions(d),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),requestAnimationFrame(this._tick)},a.Display.prototype.DEBUG=function(a,b,c){var d=[this._options.bg,this._options.fg];this.draw(a,b,null,null,d[c%d.length])},a.Display.prototype.clear=function(){this._data={},this._dirty=!0},a.Display.prototype.setOptions=function(b){for(var c in b)this._options[c]=b[c];if(b.width||b.height||b.fontSize||b.fontFamily||b.spacing||b.layout){b.layout&&(this._backend=new(a.Display[b.layout.capitalize()])(this._context));var d=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily;this._context.font=d,this._backend.compute(this._options),this._context.font=d,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0}return this},a.Display.prototype.getOptions=function(){return this._options},a.Display.prototype.getContainer=function(){return this._context.canvas},a.Display.prototype.computeSize=function(a,b){return this._backend.computeSize(a,b,this._options)},a.Display.prototype.computeFontSize=function(a,b){return this._backend.computeFontSize(a,b,this._options)},a.Display.prototype.eventToPosition=function(a){if(a.touches)var b=a.touches[0].clientX,c=a.touches[0].clientY;else var b=a.clientX,c=a.clientY;var d=this._context.canvas.getBoundingClientRect();return b-=d.left,c-=d.top,0>b||0>c||b>=this._context.canvas.width||c>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(b,c)},a.Display.prototype.draw=function(a,b,c,d,e){d||(d=this._options.fg),e||(e=this._options.bg),this._data[a+","+b]=[a,b,c,d,e],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[a+","+b]=!0)},a.Display.prototype.drawText=function(b,c,d,e){var f=null,g=null,h=b,i=c,j=1;e||(e=this._options.width-b);for(var k=a.Text.tokenize(d,e);k.length;){var l=k.shift();switch(l.type){case a.Text.TYPE_TEXT:for(var m=0;m<l.value.length;m++)this.draw(h++,i,l.value.charAt(m),f,g);break;case a.Text.TYPE_FG:f=l.value||null;break;case a.Text.TYPE_BG:g=l.value||null;break;case a.Text.TYPE_NEWLINE:h=b,i++,j++}}return j},a.Display.prototype._tick=function(){if(requestAnimationFrame(this._tick),this._dirty){if(this._dirty===!0){this._context.fillStyle=this._options.bg,this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var b in this._dirty)this._draw(b,!0);this._dirty=!1}},a.Display.prototype._draw=function(a,b){var c=this._data[a];c[4]!=this._options.bg&&(b=!0),this._backend.draw(c,b)},a.Display.Backend=function(a){this._context=a},a.Display.Backend.prototype.compute=function(){},a.Display.Backend.prototype.draw=function(){},a.Display.Backend.prototype.computeSize=function(){},a.Display.Backend.prototype.computeFontSize=function(){},a.Display.Backend.prototype.eventToPosition=function(){},a.Display.Rect=function(b){a.Display.Backend.call(this,b),this._spacingX=0,this._spacingY=0,this._canvasCache={},this._options={}},a.Display.Rect.extend(a.Display.Backend),a.Display.Rect.cache=!1,a.Display.Rect.prototype.compute=function(a){this._canvasCache={},this._options=a;var b=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(a.spacing*b),this._spacingY=Math.ceil(a.spacing*a.fontSize),this._context.canvas.width=a.width*this._spacingX,this._context.canvas.height=a.height*this._spacingY},a.Display.Rect.prototype.draw=function(a,b){this.constructor.cache?this._drawWithCache(a,b):this._drawNoCache(a,b)},a.Display.Rect.prototype._drawWithCache=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=""+d+e+f;if(g in this._canvasCache)var h=this._canvasCache[g];else{var i=this._options.border,h=document.createElement("canvas"),j=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,j.fillStyle=f,j.fillRect(i,i,h.width-i,h.height-i),d){j.fillStyle=e,j.font=this._context.font,j.textAlign="center",j.textBaseline="middle";for(var k=[].concat(d),l=0;l<k.length;l++)j.fillText(k[l],this._spacingX/2,this._spacingY/2)}this._canvasCache[g]=h}this._context.drawImage(h,b*this._spacingX,c*this._spacingY)},a.Display.Rect.prototype._drawNoCache=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4];if(b){var h=this._options.border;this._context.fillStyle=g,this._context.fillRect(c*this._spacingX+h,d*this._spacingY+h,this._spacingX-h,this._spacingY-h)}if(e){this._context.fillStyle=f;for(var i=[].concat(e),j=0;j<i.length;j++)this._context.fillText(i[j],(c+.5)*this._spacingX,(d+.5)*this._spacingY)}},a.Display.Rect.prototype.computeSize=function(a,b){var c=Math.floor(a/this._spacingX),d=Math.floor(b/this._spacingY);return[c,d]},a.Display.Rect.prototype.computeFontSize=function(a,b){var c=Math.floor(a/this._options.width),d=Math.floor(b/this._options.height),e=this._context.font;this._context.font="100px "+this._options.fontFamily;var f=Math.ceil(this._context.measureText("W").width);this._context.font=e;var g=f/100,h=g*d/c;return h>1&&(d=Math.floor(d/h)),Math.floor(d/this._options.spacing)},a.Display.Rect.prototype.eventToPosition=function(a,b){return[Math.floor(a/this._spacingX),Math.floor(b/this._spacingY)]},a.Display.Hex=function(b){a.Display.Backend.call(this,b),this._spacingX=0,this._spacingY=0,this._hexSize=0,this._options={}},a.Display.Hex.extend(a.Display.Backend),a.Display.Hex.prototype.compute=function(a){this._options=a;var b=Math.ceil(this._context.measureText("W").width);if(this._hexSize=Math.floor(a.spacing*(a.fontSize+b/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,a.transpose)var c="height",d="width";else var c="width",d="height";this._context.canvas[c]=Math.ceil((a.width+1)*this._spacingX),this._context.canvas[d]=Math.ceil((a.height-1)*this._spacingY+2*this._hexSize)},a.Display.Hex.prototype.draw=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=[(c+1)*this._spacingX,d*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),b&&(this._context.fillStyle=g,this._fill(h[0],h[1])),e){this._context.fillStyle=f;for(var i=[].concat(e),j=0;j<i.length;j++)this._context.fillText(i[j],h[0],h[1])}},a.Display.Hex.prototype.computeSize=function(a,b){this._options.transpose&&(a+=b,b=a-b,a-=b);var c=Math.floor(a/this._spacingX)-1,d=Math.floor((b-2*this._hexSize)/this._spacingY+1);return[c,d]},a.Display.Hex.prototype.computeFontSize=function(a,b){this._options.transpose&&(a+=b,b=a-b,a-=b);var c=2*a/((this._options.width+1)*Math.sqrt(3))-1,d=b/(2+1.5*(this._options.height-1)),e=Math.min(c,d),f=this._context.font;this._context.font="100px "+this._options.fontFamily;var g=Math.ceil(this._context.measureText("W").width);this._context.font=f;var h=g/100;e=Math.floor(e)+1;var i=2*e/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(i)-1},a.Display.Hex.prototype.eventToPosition=function(a,b){if(this._options.transpose){a+=b,b=a-b,a-=b;var c="width"}else var c="height";var d=this._context.canvas[c]/this._options[c];return b=Math.floor(b/d),b.mod(2)?(a-=this._spacingX,a=1+2*Math.floor(a/(2*this._spacingX))):a=2*Math.floor(a/(2*this._spacingX)),[a,b]},a.Display.Hex.prototype._fill=function(a,b){var c=this._hexSize,d=this._options.border;this._context.beginPath(),this._options.transpose?(this._context.moveTo(a-c+d,b),this._context.lineTo(a-c/2+d,b+this._spacingX-d),this._context.lineTo(a+c/2-d,b+this._spacingX-d),this._context.lineTo(a+c-d,b),this._context.lineTo(a+c/2-d,b-this._spacingX+d),this._context.lineTo(a-c/2+d,b-this._spacingX+d),this._context.lineTo(a-c+d,b)):(this._context.moveTo(a,b-c+d),this._context.lineTo(a+this._spacingX-d,b-c/2+d),this._context.lineTo(a+this._spacingX-d,b+c/2-d),this._context.lineTo(a,b+c-d),this._context.lineTo(a-this._spacingX+d,b+c/2-d),this._context.lineTo(a-this._spacingX+d,b-c/2+d),this._context.lineTo(a,b-c+d)),this._context.fill()},a.Display.Tile=function(b){a.Display.Rect.call(this,b),this._options={}},a.Display.Tile.extend(a.Display.Rect),a.Display.Tile.prototype.compute=function(a){this._options=a,this._context.canvas.width=a.width*a.tileWidth,this._context.canvas.height=a.height*a.tileHeight},a.Display.Tile.prototype.draw=function(a,b){var c=a[0],d=a[1],e=a[2],f=(a[3],a[4]),g=this._options.tileWidth,h=this._options.tileHeight;if(b){{this._options.border}this._context.fillStyle=f,this._context.fillRect(c*g,d*h,g,h)}if(e)for(var i=[].concat(e),j=0;j<i.length;j++){var k=this._options.tileMap[i[j]];if(!k)throw new Error("Char '"+i[j]+"' not found in tileMap");this._context.drawImage(this._options.tileSet,k[0],k[1],g,h,c*g,d*h,g,h)}},a.Display.Tile.prototype.computeSize=function(a,b){var c=Math.floor(a/this._options.tileWidth),d=Math.floor(b/this._options.tileHeight);return[c,d]},a.Display.Tile.prototype.computeFontSize=function(a,b){var c=Math.floor(a/this._options.width),d=Math.floor(b/this._options.height);return[c,d]},a.Display.Tile.prototype.eventToPosition=function(a,b){return[Math.floor(a/this._options.tileWidth),Math.floor(b/this._options.tileHeight)]},a.RNG={getSeed:function(){return this._seed},setSeed:function(a){return a=1>a?1/a:a,this._seed=a,this._s0=(a>>>0)*this._frac,a=69069*a+1>>>0,this._s1=a*this._frac,a=69069*a+1>>>0,this._s2=a*this._frac,this._c=1,this},getUniform:function(){var a=2091639*this._s0+this._c*this._frac;return this._s0=this._s1,this._s1=this._s2,this._c=0|a,this._s2=a-this._c,this._s2},getUniformInt:function(a,b){var c=Math.max(a,b),d=Math.min(a,b);return Math.floor(this.getUniform()*(c-d+1))+d},getNormal:function(a,b){do var c=2*this.getUniform()-1,d=2*this.getUniform()-1,e=c*c+d*d;while(e>1||0==e);var f=c*Math.sqrt(-2*Math.log(e)/e);return(a||0)+f*(b||1)},getPercentage:function(){return 1+Math.floor(100*this.getUniform())},getWeightedValue:function(a){var b=0;for(var c in a)b+=a[c];var d=Math.floor(this.getUniform()*b),e=0;for(var c in a)if(e+=a[c],e>d)return c;return null},getState:function(){return[this._s0,this._s1,this._s2,this._c]},setState:function(a){return this._s0=a[0],this._s1=a[1],this._s2=a[2],this._c=a[3],this},_s0:0,_s1:0,_s2:0,_c:0,_frac:2.3283064365386963e-10},a.RNG.setSeed(Date.now()),a.StringGenerator=function(a){this._options={words:!1,order:3,prior:.001};for(var b in a)this._options[b]=a[b];this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(var c=0;c<this._options.order;c++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}},a.StringGenerator.prototype.clear=function(){this._data={},this._priorValues={}},a.StringGenerator.prototype.generate=function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))},a.StringGenerator.prototype.observe=function(a){for(var b=this._split(a),c=0;c<b.length;c++)this._priorValues[b[c]]=this._options.prior;b=this._prefix.concat(b).concat(this._suffix);for(var c=this._options.order;c<b.length;c++)for(var d=b.slice(c-this._options.order,c),e=b[c],f=0;f<d.length;f++){var g=d.slice(f);this._observeEvent(g,e)}},a.StringGenerator.prototype.getStats=function(){var a=[],b=0;for(var c in this._priorValues)b++;b--,a.push("distinct samples: "+b);var d=0,e=0;for(var c in this._data){d++;for(var f in this._data[c])e++}return a.push("dictionary size (contexts): "+d),a.push("dictionary size (events): "+e),a.join(", ")},a.StringGenerator.prototype._split=function(a){return a.split(this._options.words?/\s+/:"")},a.StringGenerator.prototype._join=function(a){return a.join(this._options.words?" ":"")},a.StringGenerator.prototype._observeEvent=function(a,b){var c=this._join(a);c in this._data||(this._data[c]={});var d=this._data[c];b in d||(d[b]=0),d[b]++},a.StringGenerator.prototype._sample=function(a){a=this._backoff(a);var b=this._join(a),c=this._data[b],d={};if(this._options.prior){for(var e in this._priorValues)d[e]=this._priorValues[e];for(var e in c)d[e]+=c[e]}else d=c;return this._pickRandom(d)},a.StringGenerator.prototype._backoff=function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&a.length>0;)a=a.slice(1);return a},a.StringGenerator.prototype._pickRandom=function(b){var c=0;for(var d in b)c+=b[d];var e=a.RNG.getUniform()*c,f=0;for(var d in b)if(f+=b[d],f>e)return d},a.EventQueue=function(){this._time=0,this._events=[],this._eventTimes=[]},a.EventQueue.prototype.getTime=function(){return this._time},a.EventQueue.prototype.clear=function(){return this._events=[],this._eventTimes=[],this},a.EventQueue.prototype.add=function(a,b){for(var c=this._events.length,d=0;d<this._eventTimes.length;d++)if(this._eventTimes[d]>b){c=d;break}this._events.splice(c,0,a),this._eventTimes.splice(c,0,b)},a.EventQueue.prototype.get=function(){if(!this._events.length)return null;var a=this._eventTimes.splice(0,1)[0];if(a>0){this._time+=a;for(var b=0;b<this._eventTimes.length;b++)this._eventTimes[b]-=a}return this._events.splice(0,1)[0]},a.EventQueue.prototype.remove=function(a){var b=this._events.indexOf(a);return-1==b?!1:(this._remove(b),!0)},a.EventQueue.prototype._remove=function(a){this._events.splice(a,1),this._eventTimes.splice(a,1)},a.Scheduler=function(){this._queue=new a.EventQueue,this._repeat=[],this._current=null},a.Scheduler.prototype.getTime=function(){return this._queue.getTime()},a.Scheduler.prototype.add=function(a,b){return b&&this._repeat.push(a),this},a.Scheduler.prototype.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},a.Scheduler.prototype.remove=function(a){var b=this._queue.remove(a),c=this._repeat.indexOf(a);return-1!=c&&this._repeat.splice(c,1),this._current==a&&(this._current=null),b},a.Scheduler.prototype.next=function(){return this._current=this._queue.get(),this._current},a.Scheduler.Simple=function(){a.Scheduler.call(this)},a.Scheduler.Simple.extend(a.Scheduler),a.Scheduler.Simple.prototype.add=function(b,c){return this._queue.add(b,0),a.Scheduler.prototype.add.call(this,b,c)},a.Scheduler.Simple.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),a.Scheduler.prototype.next.call(this)},a.Scheduler.Speed=function(){a.Scheduler.call(this)},a.Scheduler.Speed.extend(a.Scheduler),a.Scheduler.Speed.prototype.add=function(b,c){return this._queue.add(b,1/b.getSpeed()),a.Scheduler.prototype.add.call(this,b,c)},a.Scheduler.Speed.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),a.Scheduler.prototype.next.call(this)},a.Scheduler.Action=function(){a.Scheduler.call(this),this._defaultDuration=1,this._duration=this._defaultDuration},a.Scheduler.Action.extend(a.Scheduler),a.Scheduler.Action.prototype.add=function(b,c,d){return this._queue.add(b,d||this._defaultDuration),a.Scheduler.prototype.add.call(this,b,c)},a.Scheduler.Action.prototype.clear=function(){return this._duration=this._defaultDuration,a.Scheduler.prototype.clear.call(this)},a.Scheduler.Action.prototype.remove=function(b){return b==this._current&&(this._duration=this._defaultDuration),a.Scheduler.prototype.remove.call(this,b)},a.Scheduler.Action.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),a.Scheduler.prototype.next.call(this)},a.Scheduler.Action.prototype.setDuration=function(a){return this._current&&(this._duration=a),this},a.Engine=function(a){this._scheduler=a,this._lock=1},a.Engine.prototype.start=function(){return this.unlock()},a.Engine.prototype.lock=function(){return this._lock++,this},a.Engine.prototype.unlock=function(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();var b=a.act();b&&b.then&&(this.lock(),b.then(this.unlock.bind(this)))}return this},a.Map=function(b,c){this._width=b||a.DEFAULT_WIDTH,this._height=c||a.DEFAULT_HEIGHT},a.Map.prototype.create=function(){},a.Map.prototype._fillMap=function(a){for(var b=[],c=0;c<this._width;c++){b.push([]);for(var d=0;d<this._height;d++)b[c].push(a)}return b},a.Map.Arena=function(b,c){a.Map.call(this,b,c)},a.Map.Arena.extend(a.Map),a.Map.Arena.prototype.create=function(a){for(var b=this._width-1,c=this._height-1,d=0;b>=d;d++)for(var e=0;c>=e;e++){var f=d&&e&&b>d&&c>e;a(d,e,f?0:1)}return this},a.Map.DividedMaze=function(b,c){a.Map.call(this,b,c),this._stack=[]},a.Map.DividedMaze.extend(a.Map),a.Map.DividedMaze.prototype.create=function(a){var b=this._width,c=this._height;this._map=[];for(var d=0;b>d;d++){this._map.push([]);for(var e=0;c>e;e++){var f=0==d||0==e||d+1==b||e+1==c;this._map[d].push(f?1:0)}}this._stack=[[1,1,b-2,c-2]],this._process();for(var d=0;b>d;d++)for(var e=0;c>e;e++)a(d,e,this._map[d][e]);return this._map=null,this},a.Map.DividedMaze.prototype._process=function(){for(;this._stack.length;){var a=this._stack.shift();this._partitionRoom(a)}},a.Map.DividedMaze.prototype._partitionRoom=function(a){for(var b=[],c=[],d=a[0]+1;d<a[2];d++){var e=this._map[d][a[1]-1],f=this._map[d][a[3]+1];e&&f&&!(d%2)&&b.push(d)}for(var g=a[1]+1;g<a[3];g++){var h=this._map[a[0]-1][g],i=this._map[a[2]+1][g];h&&i&&!(g%2)&&c.push(g)}if(b.length&&c.length){var j=b.random(),k=c.random();this._map[j][k]=1;var l=[],m=[];l.push(m);for(var d=a[0];j>d;d++)this._map[d][k]=1,m.push([d,k]);var m=[];l.push(m);for(var d=j+1;d<=a[2];d++)this._map[d][k]=1,m.push([d,k]);var m=[];l.push(m);for(var g=a[1];k>g;g++)this._map[j][g]=1,m.push([j,g]);var m=[];l.push(m);for(var g=k+1;g<=a[3];g++)this._map[j][g]=1,m.push([j,g]);for(var n=l.random(),d=0;d<l.length;d++){var m=l[d];if(m!=n){var o=m.random();this._map[o[0]][o[1]]=0}}this._stack.push([a[0],a[1],j-1,k-1]),this._stack.push([j+1,a[1],a[2],k-1]),this._stack.push([a[0],k+1,j-1,a[3]]),this._stack.push([j+1,k+1,a[2],a[3]])}},a.Map.IceyMaze=function(b,c,d){a.Map.call(this,b,c),this._regularity=d||0},a.Map.IceyMaze.extend(a.Map),a.Map.IceyMaze.prototype.create=function(b){var c=this._width,d=this._height,e=this._fillMap(1);c-=c%2?1:2,d-=d%2?1:2;var f=0,g=0,h=0,i=0,j=0,k=!1,l=[[0,0],[0,0],[0,0],[0,0]];do if(f=1+2*Math.floor(a.RNG.getUniform()*(c-1)/2),g=1+2*Math.floor(a.RNG.getUniform()*(d-1)/2),j||(e[f][g]=0),!e[f][g]){this._randomize(l);do{0==Math.floor(a.RNG.getUniform()*(this._regularity+1))&&this._randomize(l),k=!0;for(var m=0;4>m;m++)if(h=f+2*l[m][0],i=g+2*l[m][1],this._isFree(e,h,i,c,d)){e[h][i]=0,e[f+l[m][0]][g+l[m][1]]=0,f=h,g=i,k=!1,j++;break}}while(!k)}while(c*d/4>j+1);for(var m=0;m<this._width;m++)for(var n=0;n<this._height;n++)b(m,n,e[m][n]);return this._map=null,this},a.Map.IceyMaze.prototype._randomize=function(b){for(var c=0;4>c;c++)b[c][0]=0,b[c][1]=0;switch(Math.floor(4*a.RNG.getUniform())){case 0:b[0][0]=-1,b[1][0]=1,b[2][1]=-1,b[3][1]=1;break;case 1:b[3][0]=-1,b[2][0]=1,b[1][1]=-1,b[0][1]=1;break;case 2:b[2][0]=-1,b[3][0]=1,b[0][1]=-1,b[1][1]=1;break;case 3:b[1][0]=-1,b[0][0]=1,b[3][1]=-1,b[2][1]=1}},a.Map.IceyMaze.prototype._isFree=function(a,b,c,d,e){return 1>b||1>c||b>=d||c>=e?!1:a[b][c]},a.Map.EllerMaze=function(b,c){a.Map.call(this,b,c)},a.Map.EllerMaze.extend(a.Map),a.Map.EllerMaze.prototype.create=function(b){for(var c=this._fillMap(1),d=Math.ceil((this._width-2)/2),e=.375,f=[],g=[],h=0;d>h;h++)f.push(h),g.push(h);f.push(d-1);for(var i=1;i+3<this._height;i+=2)for(var h=0;d>h;h++){var j=2*h+1,k=i;c[j][k]=0,h!=f[h+1]&&a.RNG.getUniform()>e&&(this._addToList(h,f,g),c[j+1][k]=0),h!=f[h]&&a.RNG.getUniform()>e?this._removeFromList(h,f,g):c[j][k+1]=0}for(var h=0;d>h;h++){var j=2*h+1,k=i;c[j][k]=0,h!=f[h+1]&&(h==f[h]||a.RNG.getUniform()>e)&&(this._addToList(h,f,g),c[j+1][k]=0),this._removeFromList(h,f,g)}for(var h=0;h<this._width;h++)for(var i=0;i<this._height;i++)b(h,i,c[h][i]);return this},a.Map.EllerMaze.prototype._removeFromList=function(a,b,c){c[b[a]]=c[a],b[c[a]]=b[a],c[a]=a,b[a]=a},a.Map.EllerMaze.prototype._addToList=function(a,b,c){c[b[a+1]]=c[a],b[c[a]]=b[a+1],c[a]=a+1,b[a+1]=a},a.Map.Cellular=function(b,c,d){a.Map.call(this,b,c),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8,connected:!1},this.setOptions(d),this._dirs=a.DIRS[this._options.topology],this._map=this._fillMap(0)},a.Map.Cellular.extend(a.Map),a.Map.Cellular.prototype.randomize=function(b){for(var c=0;c<this._width;c++)for(var d=0;d<this._height;d++)this._map[c][d]=a.RNG.getUniform()<b?1:0;return this},a.Map.Cellular.prototype.setOptions=function(a){for(var b in a)this._options[b]=a[b]},a.Map.Cellular.prototype.set=function(a,b,c){this._map[a][b]=c},a.Map.Cellular.prototype.create=function(a){for(var b=this._fillMap(0),c=this._options.born,d=this._options.survive,e=0;e<this._height;e++){var f=1,g=0;6==this._options.topology&&(f=2,g=e%2);for(var h=g;h<this._width;h+=f){var i=this._map[h][e],j=this._getNeighbors(h,e);i&&-1!=d.indexOf(j)?b[h][e]=1:!i&&-1!=c.indexOf(j)&&(b[h][e]=1)}}if(this._map=b,this._options.connected&&this._completeMaze(),a)for(var h=0;h<this._width;h++)for(var e=0;e<this._height;e++)a(h,e,b[h][e])},a.Map.Cellular.prototype._getNeighbors=function(a,b){for(var c=0,d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],g=b+e[1];0>f||f>=this._width||0>f||g>=this._width||(c+=1==this._map[f][g]?1:0)}return c},a.Map.Cellular.prototype._completeMaze=function(){for(var b=[],c={},d=0;d<this._width;d++)for(var e=0;e<this._height;e++)if(this._freeSpace(d,e)){var f=[d,e];c[this._pointKey(f)]=f,b.push([d,e])}var g=b[a.RNG.getUniformInt(0,b.length-1)],h=this._pointKey(g),i={};for(i[h]=g,delete c[h],this._findConnected(i,c,[g]);Object.keys(c).length>0;){var f=this._getFromTo(i,c),j=f[0],k=f[1],l={};l[this._pointKey(j)]=j,this._findConnected(l,c,[j],!0),this._tunnelToConnected(k,j,i,c);for(var m in l){var n=l[m];this._map[n[0]][n[1]]=0,i[m]=n,delete c[m]}}},a.Map.Cellular.prototype._getFromTo=function(b,c){for(var d,e,f,g=Object.keys(b),h=Object.keys(c),i=0;5>i;i++){if(g.length<h.length){var j=g;e=b[j[a.RNG.getUniformInt(0,j.length-1)]],d=this._getClosest(e,c)}else{var j=h;d=c[j[a.RNG.getUniformInt(0,j.length-1)]],e=this._getClosest(d,b)}if(f=(d[0]-e[0])*(d[0]-e[0])+(d[1]-e[1])*(d[1]-e[1]),64>f)break}return[d,e]},a.Map.Cellular.prototype._getClosest=function(a,b){var c=null,d=null;for(k in b){var e=b[k],f=(e[0]-a[0])*(e[0]-a[0])+(e[1]-a[1])*(e[1]-a[1]);(null==d||d>f)&&(d=f,c=e)}return c},a.Map.Cellular.prototype._findConnected=function(a,b,c,d){for(;c.length>0;)for(var e=c.splice(0,1)[0],f=[[e[0]+1,e[1]],[e[0]-1,e[1]],[e[0],e[1]+1],[e[0],e[1]-1]],g=0;g<f.length;g++){var h=this._pointKey(f[g]);null==a[h]&&this._freeSpace(f[g][0],f[g][1])&&(a[h]=f[g],d||delete b[h],c.push(f[g]))}},a.Map.Cellular.prototype._tunnelToConnected=function(a,b,c,d){{var e,f;this._pointKey(b)}b[0]<a[0]?(e=b,f=a):(e=a,f=b);for(var g=e[0];g<=f[0];g++){this._map[g][e[1]]=0;var h=[g,e[1]],i=this._pointKey(h);c[i]=h,delete d[i]}var j=f[0];b[1]<a[1]?(e=b,f=a):(e=a,f=b);for(var k=e[1];k<f[1];k++){this._map[j][k]=0;var h=[j,k],i=this._pointKey(h);c[i]=h,delete d[i]}},a.Map.Cellular.prototype._freeSpace=function(a,b){return a>=0&&a<this._width&&b>=0&&b<this._height&&1!=this._map[a][b]},a.Map.Cellular.prototype._pointKey=function(a){return a[0]+"."+a[1]},a.Map.Dungeon=function(b,c){a.Map.call(this,b,c),this._rooms=[],this._corridors=[]},a.Map.Dungeon.extend(a.Map),a.Map.Dungeon.prototype.getRooms=function(){return this._rooms},a.Map.Dungeon.prototype.getCorridors=function(){return this._corridors},a.Map.Digger=function(b,c,d){a.Map.Dungeon.call(this,b,c),this._options={roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3};for(var e in d)this._options[e]=d[e];this._features={Room:4,Corridor:4},this._featureAttempts=20,this._walls={},this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)},a.Map.Digger.extend(a.Map.Dungeon),a.Map.Digger.prototype.create=function(a){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var b=(this._width-2)*(this._height-2);this._firstRoom();var c=Date.now();do{var d=Date.now();if(d-c>this._options.timeLimit)break;var e=this._findWall();if(!e)break;var f=e.split(","),g=parseInt(f[0]),h=parseInt(f[1]),i=this._getDiggingDirection(g,h);if(i){var j=0;do if(j++,this._tryFeature(g,h,i[0],i[1])){this._removeSurroundingWalls(g,h),this._removeSurroundingWalls(g-i[0],h-i[1]);break}while(j<this._featureAttempts);var k=0;for(var l in this._walls)this._walls[l]>1&&k++}}while(this._dug/b<this._options.dugPercentage||k);if(this._addDoors(),a)for(var m=0;m<this._width;m++)for(var n=0;n<this._height;n++)a(m,n,this._map[m][n]);return this._walls={},this._map=null,this},a.Map.Digger.prototype._digCallback=function(a,b,c){0==c||2==c?(this._map[a][b]=0,this._dug++):this._walls[a+","+b]=1},a.Map.Digger.prototype._isWallCallback=function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]},a.Map.Digger.prototype._canBeDugCallback=function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]},a.Map.Digger.prototype._priorityWallCallback=function(a,b){this._walls[a+","+b]=2},a.Map.Digger.prototype._firstRoom=function(){var b=Math.floor(this._width/2),c=Math.floor(this._height/2),d=a.Map.Feature.Room.createRandomCenter(b,c,this._options);

this._rooms.push(d),d.create(this._digCallback)},a.Map.Digger.prototype._findWall=function(){var a=[],b=[];for(var c in this._walls){var d=this._walls[c];2==d?b.push(c):a.push(c)}var e=b.length?b:a;if(!e.length)return null;var c=e.random();return delete this._walls[c],c},a.Map.Digger.prototype._tryFeature=function(b,c,d,e){var f=a.RNG.getWeightedValue(this._features);return f=a.Map.Feature[f].createRandomAt(b,c,d,e,this._options),f.isValid(this._isWallCallback,this._canBeDugCallback)?(f.create(this._digCallback),f instanceof a.Map.Feature.Room&&this._rooms.push(f),f instanceof a.Map.Feature.Corridor&&(f.createPriorityWalls(this._priorityWallCallback),this._corridors.push(f)),!0):!1},a.Map.Digger.prototype._removeSurroundingWalls=function(b,c){for(var d=a.DIRS[4],e=0;e<d.length;e++){var f=d[e],g=b+f[0],h=c+f[1];delete this._walls[g+","+h];var g=b+2*f[0],h=c+2*f[1];delete this._walls[g+","+h]}},a.Map.Digger.prototype._getDiggingDirection=function(b,c){for(var d=null,e=a.DIRS[4],f=0;f<e.length;f++){var g=e[f],h=b+g[0],i=c+g[1];if(0>h||0>i||h>=this._width||i>=this._width)return null;if(!this._map[h][i]){if(d)return null;d=g}}return d?[-d[0],-d[1]]:null},a.Map.Digger.prototype._addDoors=function(){for(var a=this._map,b=function(b,c){return 1==a[b][c]},c=0;c<this._rooms.length;c++){var d=this._rooms[c];d.clearDoors(),d.addDoors(b)}},a.Map.Uniform=function(b,c,d){a.Map.Dungeon.call(this,b,c),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3};for(var e in d)this._options[e]=d[e];this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)},a.Map.Uniform.extend(a.Map.Dungeon),a.Map.Uniform.prototype.create=function(a){for(var b=Date.now();;){var c=Date.now();if(c-b>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(a)for(var d=0;d<this._width;d++)for(var e=0;e<this._height;e++)a(d,e,this._map[d][e]);return this},a.Map.Uniform.prototype._generateRooms=function(){var a=this._width-2,b=this._height-2;do{var c=this._generateRoom();if(this._dug/(a*b)>this._options.roomDugPercentage)break}while(c)},a.Map.Uniform.prototype._generateRoom=function(){for(var b=0;b<this._roomAttempts;){b++;var c=a.Map.Feature.Room.createRandom(this._width,this._height,this._options);if(c.isValid(this._isWallCallback,this._canBeDugCallback))return c.create(this._digCallback),this._rooms.push(c),c}return null},a.Map.Uniform.prototype._generateCorridors=function(){for(var a=0;a<this._corridorAttempts;){a++,this._corridors=[],this._map=this._fillMap(1);for(var b=0;b<this._rooms.length;b++){var c=this._rooms[b];c.clearDoors(),c.create(this._digCallback)}for(this._unconnected=this._rooms.slice().randomize(),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){var d=this._connected.random(),e=this._closestRoom(this._unconnected,d),f=this._closestRoom(this._connected,e),g=this._connectRooms(e,f);if(!g)break;if(!this._unconnected.length)return!0}}return!1},a.Map.Uniform.prototype._closestRoom=function(a,b){for(var c=1/0,d=b.getCenter(),e=null,f=0;f<a.length;f++){var g=a[f],h=g.getCenter(),i=h[0]-d[0],j=h[1]-d[1],k=i*i+j*j;c>k&&(c=k,e=g)}return e},a.Map.Uniform.prototype._connectRooms=function(a,b){var c=a.getCenter(),d=b.getCenter(),e=d[0]-c[0],f=d[1]-c[1];if(Math.abs(e)<Math.abs(f))var g=f>0?2:0,h=(g+2)%4,i=b.getLeft(),j=b.getRight(),k=0;else var g=e>0?1:3,h=(g+2)%4,i=b.getTop(),j=b.getBottom(),k=1;var l=this._placeInWall(a,g);if(!l)return!1;if(l[k]>=i&&l[k]<=j){var m=l.slice(),n=null;switch(h){case 0:n=b.getTop()-1;break;case 1:n=b.getRight()+1;break;case 2:n=b.getBottom()+1;break;case 3:n=b.getLeft()-1}m[(k+1)%2]=n,this._digLine([l,m])}else if(l[k]<i-1||l[k]>j+1){var o=l[k]-d[k];switch(h){case 0:case 1:var p=0>o?3:1;break;case 2:case 3:var p=0>o?1:3}h=(h+p)%4;var m=this._placeInWall(b,h);if(!m)return!1;var q=[0,0];q[k]=l[k];var r=(k+1)%2;q[r]=m[r],this._digLine([l,q,m])}else{var r=(k+1)%2,m=this._placeInWall(b,h);if(!m)return;var q=Math.round((m[r]+l[r])/2),s=[0,0],t=[0,0];s[k]=l[k],s[r]=q,t[k]=m[k],t[r]=q,this._digLine([l,s,t,m])}a.addDoor(l[0],l[1]),b.addDoor(m[0],m[1]);var k=this._unconnected.indexOf(a);-1!=k&&(this._unconnected.splice(k,1),this._connected.push(a));var k=this._unconnected.indexOf(b);return-1!=k&&(this._unconnected.splice(k,1),this._connected.push(b)),!0},a.Map.Uniform.prototype._placeInWall=function(a,b){var c=[0,0],d=[0,0],e=0;switch(b){case 0:d=[1,0],c=[a.getLeft(),a.getTop()-1],e=a.getRight()-a.getLeft()+1;break;case 1:d=[0,1],c=[a.getRight()+1,a.getTop()],e=a.getBottom()-a.getTop()+1;break;case 2:d=[1,0],c=[a.getLeft(),a.getBottom()+1],e=a.getRight()-a.getLeft()+1;break;case 3:d=[0,1],c=[a.getLeft()-1,a.getTop()],e=a.getBottom()-a.getTop()+1}for(var f=[],g=-2,h=0;e>h;h++){var i=c[0]+h*d[0],j=c[1]+h*d[1];f.push(null);var k=1==this._map[i][j];k?g!=h-1&&(f[h]=[i,j]):(g=h,h&&(f[h-1]=null))}for(var h=f.length-1;h>=0;h--)f[h]||f.splice(h,1);return f.length?f.random():null},a.Map.Uniform.prototype._digLine=function(b){for(var c=1;c<b.length;c++){var d=b[c-1],e=b[c],f=new a.Map.Feature.Corridor(d[0],d[1],e[0],e[1]);f.create(this._digCallback),this._corridors.push(f)}},a.Map.Uniform.prototype._digCallback=function(a,b,c){this._map[a][b]=c,0==c&&this._dug++},a.Map.Uniform.prototype._isWallCallback=function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]},a.Map.Uniform.prototype._canBeDugCallback=function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]},a.Map.Rogue=function(b,c,d){a.Map.call(this,b,c),this._options={cellWidth:3,cellHeight:3};for(var e in d)this._options[e]=d[e];this._options.hasOwnProperty("roomWidth")||(this._options.roomWidth=this._calculateRoomSize(this._width,this._options.cellWidth)),this._options.hasOwnProperty.roomHeight||(this._options.roomHeight=this._calculateRoomSize(this._height,this._options.cellHeight))},a.Map.Rogue.extend(a.Map),a.Map.Rogue.prototype.create=function(a){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),a)for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++)a(b,c,this.map[b][c]);return this},a.Map.Rogue.prototype._getRandomInt=function(b,c){return Math.floor(a.RNG.getUniform()*(c-b+1))+b},a.Map.Rogue.prototype._calculateRoomSize=function(a,b){var c=Math.floor(a/b*.8),d=Math.floor(a/b*.25);return 2>d&&(d=2),2>c&&(c=2),[d,c]},a.Map.Rogue.prototype._initRooms=function(){for(var a=0;a<this._options.cellWidth;a++){this.rooms.push([]);for(var b=0;b<this._options.cellHeight;b++)this.rooms[a].push({x:0,y:0,width:0,height:0,connections:[],cellx:a,celly:b})}},a.Map.Rogue.prototype._connectRooms=function(){var b,c,d,e,f,g=this._getRandomInt(0,this._options.cellWidth-1),h=this._getRandomInt(0,this._options.cellHeight-1),i=!1;do{var j=[0,2,4,6];j=j.randomize();do if(i=!1,b=j.pop(),c=g+a.DIRS[8][b][0],d=h+a.DIRS[8][b][1],!(0>c||c>=this._options.cellWidth||0>d||d>=this._options.cellHeight)){if(e=this.rooms[g][h],e.connections.length>0&&e.connections[0][0]==c&&e.connections[0][1]==d)break;f=this.rooms[c][d],0==f.connections.length&&(f.connections.push([g,h]),this.connectedCells.push([c,d]),g=c,h=d,i=!0)}while(j.length>0&&0==i)}while(j.length>0)},a.Map.Rogue.prototype._connectUnconnectedRooms=function(){var b=this._options.cellWidth,c=this._options.cellHeight;this.connectedCells=this.connectedCells.randomize();for(var d,e,f,g=0;g<this._options.cellWidth;g++)for(var h=0;h<this._options.cellHeight;h++)if(d=this.rooms[g][h],0==d.connections.length){var i=[0,2,4,6];i=i.randomize();var f=!1;do{var j=i.pop(),k=g+a.DIRS[8][j][0],l=h+a.DIRS[8][j][1];if(!(0>k||k>=b||0>l||l>=c)){if(e=this.rooms[k][l],f=!0,0==e.connections.length)break;for(var m=0;m<e.connections.length;m++)if(e.connections[m][0]==g&&e.connections[m][1]==h){f=!1;break}if(f)break}}while(i.length);f?d.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}},a.Map.Rogue.prototype._createRandomRoomConnections=function(){},a.Map.Rogue.prototype._createRooms=function(){for(var a,b,c,d,e,f=this._width,g=this._height,h=this._options.cellWidth,i=this._options.cellHeight,j=Math.floor(this._width/h),k=Math.floor(this._height/i),l=this._options.roomWidth,m=this._options.roomHeight,n=0;h>n;n++)for(var o=0;i>o;o++){if(c=j*n,d=k*o,0==c&&(c=1),0==d&&(d=1),a=this._getRandomInt(l[0],l[1]),b=this._getRandomInt(m[0],m[1]),o>0)for(e=this.rooms[n][o-1];d-(e.y+e.height)<3;)d++;if(n>0)for(e=this.rooms[n-1][o];c-(e.x+e.width)<3;)c++;for(var p=Math.round(this._getRandomInt(0,j-a)/2),q=Math.round(this._getRandomInt(0,k-b)/2);c+p+a>=f;)p?p--:a--;for(;d+q+b>=g;)q?q--:b--;c+=p,d+=q,this.rooms[n][o].x=c,this.rooms[n][o].y=d,this.rooms[n][o].width=a,this.rooms[n][o].height=b;for(var r=c;c+a>r;r++)for(var s=d;d+b>s;s++)this.map[r][s]=0}},a.Map.Rogue.prototype._getWallPosition=function(a,b){var c,d,e;return 1==b||3==b?(c=this._getRandomInt(a.x+1,a.x+a.width-2),1==b?(d=a.y-2,e=d+1):(d=a.y+a.height+1,e=d-1),this.map[c][e]=0):(2==b||4==b)&&(d=this._getRandomInt(a.y+1,a.y+a.height-2),2==b?(c=a.x+a.width+1,e=c-1):(c=a.x-2,e=c+1),this.map[e][d]=0),[c,d]},a.Map.Rogue.prototype._drawCorridore=function(b,c){var d,e,f,g,h=c[0]-b[0],i=c[1]-b[1],j=b[0],k=b[1],l=[],m=Math.abs(h),n=Math.abs(i),o=a.RNG.getUniform(),p=o,q=1-o;for(e=h>0?2:6,f=i>0?4:0,n>m?(d=Math.ceil(n*p),l.push([f,d]),l.push([e,m]),d=Math.floor(n*q),l.push([f,d])):(d=Math.ceil(m*p),l.push([e,d]),l.push([f,n]),d=Math.floor(m*q),l.push([e,d])),this.map[j][k]=0;l.length>0;)for(g=l.pop();g[1]>0;)j+=a.DIRS[8][g[0]][0],k+=a.DIRS[8][g[0]][1],this.map[j][k]=0,g[1]=g[1]-1},a.Map.Rogue.prototype._createCorridors=function(){for(var a,b,c,d,e,f=this._options.cellWidth,g=this._options.cellHeight,h=0;f>h;h++)for(var i=0;g>i;i++){a=this.rooms[h][i];for(var j=0;j<a.connections.length;j++)b=a.connections[j],c=this.rooms[b[0]][b[1]],c.cellx>a.cellx?(d=2,e=4):c.cellx<a.cellx?(d=4,e=2):c.celly>a.celly?(d=3,e=1):c.celly<a.celly&&(d=1,e=3),this._drawCorridore(this._getWallPosition(a,d),this._getWallPosition(c,e))}},a.Map.Feature=function(){},a.Map.Feature.prototype.isValid=function(){},a.Map.Feature.prototype.create=function(){},a.Map.Feature.prototype.debug=function(){},a.Map.Feature.createRandomAt=function(){},a.Map.Feature.Room=function(a,b,c,d,e,f){this._x1=a,this._y1=b,this._x2=c,this._y2=d,this._doors={},arguments.length>4&&this.addDoor(e,f)},a.Map.Feature.Room.extend(a.Map.Feature),a.Map.Feature.Room.createRandomAt=function(b,c,d,e,f){var g=f.roomWidth[0],h=f.roomWidth[1],i=g+Math.floor(a.RNG.getUniform()*(h-g+1)),g=f.roomHeight[0],h=f.roomHeight[1],j=g+Math.floor(a.RNG.getUniform()*(h-g+1));if(1==d){var k=c-Math.floor(a.RNG.getUniform()*j);return new this(b+1,k,b+i,k+j-1,b,c)}if(-1==d){var k=c-Math.floor(a.RNG.getUniform()*j);return new this(b-i,k,b-1,k+j-1,b,c)}if(1==e){var l=b-Math.floor(a.RNG.getUniform()*i);return new this(l,c+1,l+i-1,c+j,b,c)}if(-1==e){var l=b-Math.floor(a.RNG.getUniform()*i);return new this(l,c-j,l+i-1,c-1,b,c)}},a.Map.Feature.Room.createRandomCenter=function(b,c,d){var e=d.roomWidth[0],f=d.roomWidth[1],g=e+Math.floor(a.RNG.getUniform()*(f-e+1)),e=d.roomHeight[0],f=d.roomHeight[1],h=e+Math.floor(a.RNG.getUniform()*(f-e+1)),i=b-Math.floor(a.RNG.getUniform()*g),j=c-Math.floor(a.RNG.getUniform()*h),k=i+g-1,l=j+h-1;return new this(i,j,k,l)},a.Map.Feature.Room.createRandom=function(b,c,d){var e=d.roomWidth[0],f=d.roomWidth[1],g=e+Math.floor(a.RNG.getUniform()*(f-e+1)),e=d.roomHeight[0],f=d.roomHeight[1],h=e+Math.floor(a.RNG.getUniform()*(f-e+1)),i=b-g-1,j=c-h-1,k=1+Math.floor(a.RNG.getUniform()*i),l=1+Math.floor(a.RNG.getUniform()*j),m=k+g-1,n=l+h-1;return new this(k,l,m,n)},a.Map.Feature.Room.prototype.addDoor=function(a,b){return this._doors[a+","+b]=1,this},a.Map.Feature.Room.prototype.getDoors=function(a){for(var b in this._doors){var c=b.split(",");a(parseInt(c[0]),parseInt(c[1]))}return this},a.Map.Feature.Room.prototype.clearDoors=function(){return this._doors={},this},a.Map.Feature.Room.prototype.addDoors=function(a){for(var b=this._x1-1,c=this._x2+1,d=this._y1-1,e=this._y2+1,f=b;c>=f;f++)for(var g=d;e>=g;g++)(f==b||f==c||g==d||g==e)&&(a(f,g)||this.addDoor(f,g));return this},a.Map.Feature.Room.prototype.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},a.Map.Feature.Room.prototype.isValid=function(a,b){for(var c=this._x1-1,d=this._x2+1,e=this._y1-1,f=this._y2+1,g=c;d>=g;g++)for(var h=e;f>=h;h++)if(g==c||g==d||h==e||h==f){if(!a(g,h))return!1}else if(!b(g,h))return!1;return!0},a.Map.Feature.Room.prototype.create=function(a){for(var b=this._x1-1,c=this._x2+1,d=this._y1-1,e=this._y2+1,f=0,g=b;c>=g;g++)for(var h=d;e>=h;h++)f=g+","+h in this._doors?2:g==b||g==c||h==d||h==e?1:0,a(g,h,f)},a.Map.Feature.Room.prototype.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},a.Map.Feature.Room.prototype.getLeft=function(){return this._x1},a.Map.Feature.Room.prototype.getRight=function(){return this._x2},a.Map.Feature.Room.prototype.getTop=function(){return this._y1},a.Map.Feature.Room.prototype.getBottom=function(){return this._y2},a.Map.Feature.Corridor=function(a,b,c,d){this._startX=a,this._startY=b,this._endX=c,this._endY=d,this._endsWithAWall=!0},a.Map.Feature.Corridor.extend(a.Map.Feature),a.Map.Feature.Corridor.createRandomAt=function(b,c,d,e,f){var g=f.corridorLength[0],h=f.corridorLength[1],i=g+Math.floor(a.RNG.getUniform()*(h-g+1));return new this(b,c,b+d*i,c+e*i)},a.Map.Feature.Corridor.prototype.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},a.Map.Feature.Corridor.prototype.isValid=function(a,b){var c=this._startX,d=this._startY,e=this._endX-c,f=this._endY-d,g=1+Math.max(Math.abs(e),Math.abs(f));e&&(e/=Math.abs(e)),f&&(f/=Math.abs(f));for(var h=f,i=-e,j=!0,k=0;g>k;k++){var l=c+k*e,m=d+k*f;if(b(l,m)||(j=!1),a(l+h,m+i)||(j=!1),a(l-h,m-i)||(j=!1),!j){g=k,this._endX=l-e,this._endY=m-f;break}}if(0==g)return!1;if(1==g&&a(this._endX+e,this._endY+f))return!1;var n=!a(this._endX+e+h,this._endY+f+i),o=!a(this._endX+e-h,this._endY+f-i);return this._endsWithAWall=a(this._endX+e,this._endY+f),(n||o)&&this._endsWithAWall?!1:!0},a.Map.Feature.Corridor.prototype.create=function(a){var b=this._startX,c=this._startY,d=this._endX-b,e=this._endY-c,f=1+Math.max(Math.abs(d),Math.abs(e));d&&(d/=Math.abs(d)),e&&(e/=Math.abs(e));for(var g=0;f>g;g++){var h=b+g*d,i=c+g*e;a(h,i,0)}return!0},a.Map.Feature.Corridor.prototype.createPriorityWalls=function(a){if(this._endsWithAWall){var b=this._startX,c=this._startY,d=this._endX-b,e=this._endY-c;d&&(d/=Math.abs(d)),e&&(e/=Math.abs(e));var f=e,g=-d;a(this._endX+d,this._endY+e),a(this._endX+f,this._endY+g),a(this._endX-f,this._endY-g)}},a.Noise=function(){},a.Noise.prototype.get=function(){},a.Noise.Simplex=function(b){a.Noise.call(this),this._F2=.5*(Math.sqrt(3)-1),this._G2=(3-Math.sqrt(3))/6,this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var c=[],d=b||256,e=0;d>e;e++)c.push(e);c=c.randomize(),this._perms=[],this._indexes=[];for(var e=0;2*d>e;e++)this._perms.push(c[e%d]),this._indexes.push(this._perms[e]%this._gradients.length)},a.Noise.Simplex.extend(a.Noise),a.Noise.Simplex.prototype.get=function(a,b){var c,d,e,f=this._perms,g=this._indexes,h=f.length/2,i=this._G2,j=0,k=0,l=0,m=(a+b)*this._F2,n=Math.floor(a+m),o=Math.floor(b+m),p=(n+o)*i,q=n-p,r=o-p,s=a-q,t=b-r;s>t?(d=1,e=0):(d=0,e=1);var u=s-d+i,v=t-e+i,w=s-1+2*i,x=t-1+2*i,y=n.mod(h),z=o.mod(h),A=.5-s*s-t*t;if(A>=0){A*=A,c=g[y+f[z]];var B=this._gradients[c];j=A*A*(B[0]*s+B[1]*t)}var C=.5-u*u-v*v;if(C>=0){C*=C,c=g[y+d+f[z+e]];var B=this._gradients[c];k=C*C*(B[0]*u+B[1]*v)}var D=.5-w*w-x*x;if(D>=0){D*=D,c=g[y+1+f[z+1]];var B=this._gradients[c];l=D*D*(B[0]*w+B[1]*x)}return 70*(j+k+l)},a.FOV=function(a,b){this._lightPasses=a,this._options={topology:8};for(var c in b)this._options[c]=b[c]},a.FOV.prototype.compute=function(){},a.FOV.prototype._getCircle=function(b,c,d){var e,f,g,h=[];switch(this._options.topology){case 4:f=1,g=[0,1],e=[a.DIRS[8][7],a.DIRS[8][1],a.DIRS[8][3],a.DIRS[8][5]];break;case 6:e=a.DIRS[6],f=1,g=[-1,1];break;case 8:e=a.DIRS[4],f=2,g=[-1,1]}for(var i=b+g[0]*d,j=c+g[1]*d,k=0;k<e.length;k++)for(var l=0;d*f>l;l++)h.push([i,j]),i+=e[k][0],j+=e[k][1];return h},a.FOV.DiscreteShadowcasting=function(b,c){a.FOV.call(this,b,c)},a.FOV.DiscreteShadowcasting.extend(a.FOV),a.FOV.DiscreteShadowcasting.prototype.compute=function(a,b,c,d){this._coords,this._map;if(d(a,b,0),this._lightPasses(a,b))for(var e,f,g,h,i,j=[],k=1;c>=k;k++)for(var l=this._getCircle(a,b,k),m=360/l.length,n=0;n<l.length;n++)if(g=l[n][0],h=l[n][1],e=m*(n-.5),f=e+m,i=!this._lightPasses(g,h),this._visibleCoords(Math.floor(e),Math.ceil(f),i,j)&&d(g,h,k,1),2==j.length&&0==j[0]&&360==j[1])return},a.FOV.DiscreteShadowcasting.prototype._visibleCoords=function(a,b,c,d){if(0>a){var e=arguments.callee(0,b,c,d),f=arguments.callee(360+a,360,c,d);return e||f}for(var g=0;g<d.length&&d[g]<a;)g++;if(g==d.length)return c&&d.push(a,b),!0;var h=0;if(g%2){for(;g<d.length&&d[g]<b;)g++,h++;return 0==h?!1:(c&&(h%2?d.splice(g-h,h,b):d.splice(g-h,h)),!0)}for(;g<d.length&&d[g]<b;)g++,h++;return a==d[g-h]&&1==h?!1:(c&&(h%2?d.splice(g-h,h,a):d.splice(g-h,h,a,b)),!0)},a.FOV.PreciseShadowcasting=function(b,c){a.FOV.call(this,b,c)},a.FOV.PreciseShadowcasting.extend(a.FOV),a.FOV.PreciseShadowcasting.prototype.compute=function(a,b,c,d){if(d(a,b,0,1),this._lightPasses(a,b))for(var e,f,g,h,i,j,k=[],l=1;c>=l;l++)for(var m=this._getCircle(a,b,l),n=m.length,o=0;n>o;o++)if(e=m[o][0],f=m[o][1],h=[o?2*o-1:2*n-1,2*n],i=[2*o+1,2*n],g=!this._lightPasses(e,f),j=this._checkVisibility(h,i,g,k),j&&d(e,f,l,j),2==k.length&&0==k[0][0]&&k[1][0]==k[1][1])return},a.FOV.PreciseShadowcasting.prototype._checkVisibility=function(a,b,c,d){if(a[0]>b[0]){var e=this._checkVisibility(a,[a[1],a[1]],c,d),f=this._checkVisibility([0,1],b,c,d);return(e+f)/2}for(var g=0,h=!1;g<d.length;){var i=d[g],j=i[0]*a[1]-a[0]*i[1];if(j>=0){0==j&&!(g%2)&&(h=!0);break}g++}for(var k=d.length,l=!1;k--;){var i=d[k],j=b[0]*i[1]-i[0]*b[1];if(j>=0){0==j&&k%2&&(l=!0);break}}var m=!0;if(g==k&&(h||l)?m=!1:h&&l&&g+1==k&&k%2?m=!1:g>k&&g%2&&(m=!1),!m)return 0;var n,o,p=k-g+1;if(p%2)if(g%2){var o=d[g];n=(b[0]*o[1]-o[0]*b[1])/(o[1]*b[1]),c&&d.splice(g,p,b)}else{var o=d[k];n=(o[0]*a[1]-a[0]*o[1])/(a[1]*o[1]),c&&d.splice(g,p,a)}else{if(!(g%2))return c&&d.splice(g,p,a,b),1;var q=d[g],r=d[k];n=(r[0]*q[1]-q[0]*r[1])/(q[1]*r[1]),c&&d.splice(g,p)}var s=(b[0]*a[1]-a[0]*b[1])/(a[1]*b[1]);return n/s},a.FOV.RecursiveShadowcasting=function(b,c){a.FOV.call(this,b,c)},a.FOV.RecursiveShadowcasting.extend(a.FOV),a.FOV.RecursiveShadowcasting.OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],a.FOV.RecursiveShadowcasting.prototype.compute=function(b,c,d,e){e(b,c,0,!0);for(var f=0;f<a.FOV.RecursiveShadowcasting.OCTANTS.length;f++)this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[f],d,e)},a.FOV.RecursiveShadowcasting.prototype.compute180=function(b,c,d,e,f){f(b,c,0,!0);var g=(e-1+8)%8,h=(e-2+8)%8,i=(e+1+8)%8;this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[h],d,f),this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[g],d,f),this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[e],d,f),this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[i],d,f)},a.FOV.RecursiveShadowcasting.prototype.compute90=function(b,c,d,e,f){f(b,c,0,!0);var g=(e-1+8)%8;this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[e],d,f),this._renderOctant(b,c,a.FOV.RecursiveShadowcasting.OCTANTS[g],d,f)},a.FOV.RecursiveShadowcasting.prototype._renderOctant=function(a,b,c,d,e){this._castVisibility(a,b,1,1,0,d+1,c[0],c[1],c[2],c[3],e)},a.FOV.RecursiveShadowcasting.prototype._castVisibility=function(a,b,c,d,e,f,g,h,i,j,k){if(!(e>d))for(var l=c;f>=l;l++){for(var m=-l-1,n=-l,o=!1,p=0;0>=m;){m+=1;var q=a+m*g+n*h,r=b+m*i+n*j,s=(m-.5)/(n+.5),t=(m+.5)/(n-.5);if(!(t>d)){if(e>s)break;if(f*f>m*m+n*n&&k(q,r,l,!0),o){if(!this._lightPasses(q,r)){p=t;continue}o=!1,d=p}else!this._lightPasses(q,r)&&f>l&&(o=!0,this._castVisibility(a,b,l+1,d,s,f,g,h,i,j,k),p=t)}}if(o)break}},a.Color={fromString:function(a){var b,c;if(a in this._cache)b=this._cache[a];else{if("#"==a.charAt(0)){var d=a.match(/[0-9a-f]/gi).map(function(a){return parseInt(a,16)});if(3==d.length)b=d.map(function(a){return 17*a});else{for(var e=0;3>e;e++)d[e+1]+=16*d[e],d.splice(e,1);b=d}}else b=(c=a.match(/rgb\(([0-9, ]+)\)/i))?c[1].split(/\s*,\s*/).map(function(a){return parseInt(a)}):[0,0,0];this._cache[a]=b}return b.slice()},add:function(a){for(var b=a.slice(),c=0;3>c;c++)for(var d=1;d<arguments.length;d++)b[c]+=arguments[d][c];return b},add_:function(a){for(var b=0;3>b;b++)for(var c=1;c<arguments.length;c++)a[b]+=arguments[c][b];return a},multiply:function(a){for(var b=a.slice(),c=0;3>c;c++){for(var d=1;d<arguments.length;d++)b[c]*=arguments[d][c]/255;b[c]=Math.round(b[c])}return b},multiply_:function(a){for(var b=0;3>b;b++){for(var c=1;c<arguments.length;c++)a[b]*=arguments[c][b]/255;a[b]=Math.round(a[b])}return a},interpolate:function(a,b,c){arguments.length<3&&(c=.5);for(var d=a.slice(),e=0;3>e;e++)d[e]=Math.round(d[e]+c*(b[e]-a[e]));return d},interpolateHSL:function(a,b,c){arguments.length<3&&(c=.5);for(var d=this.rgb2hsl(a),e=this.rgb2hsl(b),f=0;3>f;f++)d[f]+=c*(e[f]-d[f]);return this.hsl2rgb(d)},randomize:function(b,c){c instanceof Array||(c=a.RNG.getNormal(0,c));for(var d=b.slice(),e=0;3>e;e++)d[e]+=c instanceof Array?Math.round(a.RNG.getNormal(0,c[e])):c;return d},rgb2hsl:function(a){var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=Math.max(d,e,f),h=Math.min(d,e,f),i=(g+h)/2;if(g==h)b=c=0;else{var j=g-h;switch(c=i>.5?j/(2-g-h):j/(g+h),g){case d:b=(e-f)/j+(f>e?6:0);break;case e:b=(f-d)/j+2;break;case f:b=(d-e)/j+4}b/=6}return[b,c,i]},hsl2rgb:function(a){function b(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var c=a[2];if(0==a[1])return c=Math.round(255*c),[c,c,c];var d=a[1],e=.5>c?c*(1+d):c+d-c*d,f=2*c-e,g=b(f,e,a[0]+1/3),h=b(f,e,a[0]),i=b(f,e,a[0]-1/3);return[Math.round(255*g),Math.round(255*h),Math.round(255*i)]},toRGB:function(a){return"rgb("+this._clamp(a[0])+","+this._clamp(a[1])+","+this._clamp(a[2])+")"},toHex:function(a){for(var b=[],c=0;3>c;c++)b.push(this._clamp(a[c]).toString(16).lpad("0",2));return"#"+b.join("")},_clamp:function(a){return 0>a?0:a>255?255:a},_cache:{black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},a.Lighting=function(a,b){this._reflectivityCallback=a,this._options={passes:1,emissionThreshold:100,range:10},this._fov=null,this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(b)},a.Lighting.prototype.setOptions=function(a){for(var b in a)this._options[b]=a[b];return a.range&&this.reset(),this},a.Lighting.prototype.setFOV=function(a){return this._fov=a,this._fovCache={},this},a.Lighting.prototype.setLight=function(b,c,d){var e=b+","+c;return d?this._lights[e]="string"==typeof d?a.Color.fromString(d):d:delete this._lights[e],this},a.Lighting.prototype.reset=function(){return this._reflectivityCache={},this._fovCache={},this},a.Lighting.prototype.compute=function(b){var c={},d={},e={};for(var f in this._lights){var g=this._lights[f];f in d||(d[f]=[0,0,0]),a.Color.add_(d[f],g)}for(var h=0;h<this._options.passes;h++)this._emitLight(d,e,c),h+1!=this._options.passes&&(d=this._computeEmitters(e,c));for(var i in e){var j=i.split(","),k=parseInt(j[0]),l=parseInt(j[1]);b(k,l,e[i])}return this},a.Lighting.prototype._emitLight=function(a,b,c){for(var d in a){var e=d.split(","),f=parseInt(e[0]),g=parseInt(e[1]);this._emitLightFromCell(f,g,a[d],b),c[d]=1}return this},a.Lighting.prototype._computeEmitters=function(a,b){var c={};for(var d in a)if(!(d in b)){var e=a[d];if(d in this._reflectivityCache)var f=this._reflectivityCache[d];else{var g=d.split(","),h=parseInt(g[0]),i=parseInt(g[1]),f=this._reflectivityCallback(h,i);this._reflectivityCache[d]=f}if(0!=f){for(var j=[],k=0,l=0;3>l;l++){var m=Math.round(e[l]*f);j[l]=m,k+=m}k>this._options.emissionThreshold&&(c[d]=j)}}return c},a.Lighting.prototype._emitLightFromCell=function(a,b,c,d){var e=a+","+b;if(e in this._fovCache)var f=this._fovCache[e];else var f=this._updateFOV(a,b);for(var g in f){var h=f[g];if(g in d)var i=d[g];else{var i=[0,0,0];d[g]=i}for(var j=0;3>j;j++)i[j]+=Math.round(c[j]*h)}return this},a.Lighting.prototype._updateFOV=function(a,b){var c=a+","+b,d={};this._fovCache[c]=d;var e=this._options.range,f=function(a,b,c,f){var g=a+","+b,h=f*(1-c/e);0!=h&&(d[g]=h)};return this._fov.compute(a,b,e,f.bind(this)),d},a.Path=function(b,c,d,e){this._toX=b,this._toY=c,this._fromX=null,this._fromY=null,this._passableCallback=d,this._options={topology:8};for(var f in e)this._options[f]=e[f];this._dirs=a.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])},a.Path.prototype.compute=function(){},a.Path.prototype._getNeighbors=function(a,b){for(var c=[],d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],g=b+e[1];this._passableCallback(f,g)&&c.push([f,g])}return c},a.Path.Dijkstra=function(b,c,d,e){a.Path.call(this,b,c,d,e),this._computed={},this._todo=[],this._add(b,c,null)},a.Path.Dijkstra.extend(a.Path),a.Path.Dijkstra.prototype.compute=function(a,b,c){var d=a+","+b;if(d in this._computed||this._compute(a,b),d in this._computed)for(var e=this._computed[d];e;)c(e.x,e.y),e=e.prev},a.Path.Dijkstra.prototype._compute=function(a,b){for(;this._todo.length;){var c=this._todo.shift();if(c.x==a&&c.y==b)return;for(var d=this._getNeighbors(c.x,c.y),e=0;e<d.length;e++){var f=d[e],g=f[0],h=f[1],i=g+","+h;i in this._computed||this._add(g,h,c)}}},a.Path.Dijkstra.prototype._add=function(a,b,c){var d={x:a,y:b,prev:c};this._computed[a+","+b]=d,this._todo.push(d)},a.Path.AStar=function(b,c,d,e){a.Path.call(this,b,c,d,e),this._todo=[],this._done={},this._fromX=null,this._fromY=null},a.Path.AStar.extend(a.Path),a.Path.AStar.prototype.compute=function(a,b,c){for(this._todo=[],this._done={},this._fromX=a,this._fromY=b,this._add(this._toX,this._toY,null);this._todo.length;){var d=this._todo.shift();if(d.x==a&&d.y==b)break;for(var e=this._getNeighbors(d.x,d.y),f=0;f<e.length;f++){var g=e[f],h=g[0],i=g[1],j=h+","+i;j in this._done||this._add(h,i,d)}}var d=this._done[a+","+b];if(d)for(;d;)c(d.x,d.y),d=d.prev},a.Path.AStar.prototype._add=function(a,b,c){var d={x:a,y:b,prev:c,g:c?c.g+1:0,h:this._distance(a,b)};this._done[a+","+b]=d;for(var e=d.g+d.h,f=0;f<this._todo.length;f++){var g=this._todo[f];if(e<g.g+g.h)return void this._todo.splice(f,0,d)}this._todo.push(d)},a.Path.AStar.prototype._distance=function(a,b){switch(this._options.topology){case 4:return Math.abs(a-this._fromX)+Math.abs(b-this._fromY);case 6:var c=Math.abs(a-this._fromX),d=Math.abs(b-this._fromY);return d+Math.max(0,(c-d)/2);case 8:return Math.max(Math.abs(a-this._fromX),Math.abs(b-this._fromY))}},define("rot",function(){}),function(){function a(a,b){if(a!==b){var c=a===a,d=b===b;if(a>b||!c||"undefined"==typeof a&&d)return 1;if(b>a||!d||"undefined"==typeof b&&c)return-1}return 0}function b(a,b,c){for(var d=a.length,e=c?d:-1;c?e--:++e<d;)if(b(a[e],e,a))return e;return-1}function c(a,b,c){if(b!==b)return n(a,c);for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function d(a){return"function"==typeof a||!1}function e(a){return"string"==typeof a?a:null==a?"":a+""}function f(a){return a.charCodeAt(0)}function g(a,b){for(var c=-1,d=a.length;++c<d&&b.indexOf(a.charAt(c))>-1;);return c}function h(a,b){for(var c=a.length;c--&&b.indexOf(a.charAt(c))>-1;);return c}function i(b,c){return a(b.criteria,c.criteria)||b.index-c.index}function j(b,c,d){for(var e=-1,f=b.criteria,g=c.criteria,h=f.length,i=d.length;++e<h;){var j=a(f[e],g[e]);if(j)return e>=i?j:j*(d[e]?1:-1)}return b.index-c.index}function k(a){return Ma[a]}function l(a){return Na[a]}function m(a){return"\\"+Qa[a]}function n(a,b,c){for(var d=a.length,e=b+(c?0:-1);c?e--:++e<d;){var f=a[e];if(f!==f)return e}return-1}function o(a){return!!a&&"object"==typeof a}function p(a){return 160>=a&&a>=9&&13>=a||32==a||160==a||5760==a||6158==a||a>=8192&&(8202>=a||8232==a||8233==a||8239==a||8287==a||12288==a||65279==a)}function q(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;)a[c]===b&&(a[c]=P,f[++e]=c);return f;

}function r(a,b){for(var c,d=-1,e=a.length,f=-1,g=[];++d<e;){var h=a[d],i=b?b(h,d,a):h;d&&c===i||(c=i,g[++f]=h)}return g}function s(a){for(var b=-1,c=a.length;++b<c&&p(a.charCodeAt(b)););return b}function t(a){for(var b=a.length;b--&&p(a.charCodeAt(b)););return b}function u(a){return Oa[a]}function v(p){function W(a){if(o(a)&&!fh(a)&&!(a instanceof Ma)){if(a instanceof aa)return a;if(Ef.call(a,"__chain__")&&Ef.call(a,"__wrapped__"))return Vc(a)}return new aa(a)}function $(){}function aa(a,b,c){this.__wrapped__=a,this.__actions__=c||[],this.__chain__=!!b}function Ma(a){this.__wrapped__=a,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=gg,this.__views__=null}function Na(){var a=this.__actions__,b=this.__iteratees__,c=this.__views__,d=new Ma(this.__wrapped__);return d.__actions__=a?$a(a):null,d.__dir__=this.__dir__,d.__filtered__=this.__filtered__,d.__iteratees__=b?$a(b):null,d.__takeCount__=this.__takeCount__,d.__views__=c?$a(c):null,d}function Oa(){if(this.__filtered__){var a=new Ma(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function Pa(){var a=this.__wrapped__.value();if(!fh(a))return Vb(a,this.__actions__);var b=this.__dir__,c=0>b,d=Ec(0,a.length,this.__views__),e=d.start,f=d.end,g=f-e,h=c?f:e-1,i=ag(g,this.__takeCount__),j=this.__iteratees__,k=j?j.length:0,l=0,m=[];a:for(;g--&&i>l;){h+=b;for(var n=-1,o=a[h];++n<k;){var p=j[n],q=p.iteratee,r=p.type;if(r==L){if(p.done&&(c?h>p.index:h<p.index)&&(p.count=0,p.done=!1),p.index=h,!p.done){var s=p.limit;if(!(p.done=s>-1?p.count++>=s:!q(o)))continue a}}else{var t=q(o);if(r==N)o=t;else if(!t){if(r==M)continue a;break a}}}m[l++]=o}return m}function Qa(){this.__data__={}}function Ra(a){return this.has(a)&&delete this.__data__[a]}function Sa(a){return"__proto__"==a?w:this.__data__[a]}function Ta(a){return"__proto__"!=a&&Ef.call(this.__data__,a)}function Ua(a,b){return"__proto__"!=a&&(this.__data__[a]=b),this}function Va(a){var b=a?a.length:0;for(this.data={hash:Yf(null),set:new Rf};b--;)this.push(a[b])}function Wa(a,b){var c=a.data,d="string"==typeof b||le(b)?c.set.has(b):c.hash[b];return d?0:-1}function Za(a){var b=this.data;"string"==typeof a||le(a)?b.set.add(a):b.hash[a]=!0}function $a(a,b){var c=-1,d=a.length;for(b||(b=of(d));++c<d;)b[c]=a[c];return b}function _a(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}function ab(a,b){for(var c=a.length;c--&&b(a[c],c,a)!==!1;);return a}function bb(a,b){for(var c=-1,d=a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function cb(a,b){for(var c=-1,d=a.length,e=-1,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[++e]=g)}return f}function db(a,b){for(var c=-1,d=a.length,e=of(d);++c<d;)e[c]=b(a[c],c,a);return e}function eb(a){for(var b=-1,c=a.length,d=fg;++b<c;){var e=a[b];e>d&&(d=e)}return d}function fb(a){for(var b=-1,c=a.length,d=gg;++b<c;){var e=a[b];d>e&&(d=e)}return d}function gb(a,b,c,d){var e=-1,f=a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function hb(a,b,c,d){var e=a.length;for(d&&e&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}function ib(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function jb(a){for(var b=a.length,c=0;b--;)c+=+a[b]||0;return c}function kb(a,b){return"undefined"==typeof a?b:a}function lb(a,b,c,d){return"undefined"!=typeof a&&Ef.call(d,c)?a:b}function mb(a,b,c){var d=rh(b);if(!c)return ob(b,a,d);for(var e=-1,f=d.length;++e<f;){var g=d[e],h=a[g],i=c(h,b[g],g,a,b);(i===i?i===h:h!==h)&&("undefined"!=typeof h||g in a)||(a[g]=i)}return a}function nb(a,b){for(var c=-1,d=a.length,e=Lc(d),f=b.length,g=of(f);++c<f;){var h=b[c];e?(h=parseFloat(h),g[c]=Ic(h,d)?a[h]:w):g[c]=a[h]}return g}function ob(a,b,c){c||(c=b,b={});for(var d=-1,e=c.length;++d<e;){var f=c[d];b[f]=a[f]}return b}function pb(a,b,c){var d=typeof a;return"function"==d?"undefined"==typeof b?a:Yb(a,b,c):null==a?af:"object"==d?Gb(a):"undefined"==typeof b?Kb(a+""):Hb(a+"",b)}function qb(a,b,c,d,e,f,g){var h;if(c&&(h=e?c(a,d,e):c(a)),"undefined"!=typeof h)return h;if(!le(a))return a;var i=fh(a);if(i){if(h=Fc(a),!b)return $a(a,h)}else{var j=Gf.call(a),k=j==V;if(j!=Y&&j!=Q&&(!k||e))return Ka[j]?Hc(a,j,b):e?a:{};if(h=Gc(k?{}:a),!b)return ob(a,h,rh(a))}f||(f=[]),g||(g=[]);for(var l=f.length;l--;)if(f[l]==a)return g[l];return f.push(a),g.push(h),(i?_a:zb)(a,function(d,e){h[e]=qb(d,b,c,e,a,f,g)}),h}function rb(a,b,c){if("function"!=typeof a)throw new xf(O);return Sf(function(){a.apply(w,c)},b)}function sb(a,b){var d=a?a.length:0,e=[];if(!d)return e;var f=-1,g=Dc(),h=g==c,i=h&&b.length>=200?vg(b):null,j=b.length;i&&(g=Wa,h=!1,b=i);a:for(;++f<d;){var k=a[f];if(h&&k===k){for(var l=j;l--;)if(b[l]===k)continue a;e.push(k)}else g(b,k,0)<0&&e.push(k)}return e}function tb(a,b){var c=!0;return qg(a,function(a,d,e){return c=!!b(a,d,e)}),c}function ub(a,b,c,d){var e=a.length;for(c=null==c?0:+c||0,0>c&&(c=-c>e?0:e+c),d="undefined"==typeof d||d>e?e:+d||0,0>d&&(d+=e),e=c>d?0:d>>>0,c>>>=0;e>c;)a[c++]=b;return a}function vb(a,b){var c=[];return qg(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c}function wb(a,b,c,d){var e;return c(a,function(a,c,f){return b(a,c,f)?(e=d?c:a,!1):void 0}),e}function xb(a,b,c){for(var d=-1,e=a.length,f=-1,g=[];++d<e;){var h=a[d];if(o(h)&&Lc(h.length)&&(fh(h)||ee(h))){b&&(h=xb(h,b,c));var i=-1,j=h.length;for(g.length+=j;++i<j;)g[++f]=h[i]}else c||(g[++f]=h)}return g}function yb(a,b){return sg(a,b,Be)}function zb(a,b){return sg(a,b,rh)}function Ab(a,b){return tg(a,b,rh)}function Bb(a,b){for(var c=-1,d=b.length,e=-1,f=[];++c<d;){var g=b[c];hh(a[g])&&(f[++e]=g)}return f}function Cb(a,b,c,d,e,f){if(a===b)return 0!==a||1/a==1/b;var g=typeof a,h=typeof b;return"function"!=g&&"object"!=g&&"function"!=h&&"object"!=h||null==a||null==b?a!==a&&b!==b:Db(a,b,Cb,c,d,e,f)}function Db(a,b,c,d,e,f,g){var h=fh(a),i=fh(b),j=R,k=R;h||(j=Gf.call(a),j==Q?j=Y:j!=Y&&(h=te(a))),i||(k=Gf.call(b),k==Q?k=Y:k!=Y&&(i=te(b)));var l=j==Y||e&&j==V,m=k==Y||e&&k==V,n=j==k;if(n&&!h&&!l)return zc(a,b,j);if(e){if(!(n||l&&m))return!1}else{var o=l&&Ef.call(a,"__wrapped__"),p=m&&Ef.call(b,"__wrapped__");if(o||p)return c(o?a.value():a,p?b.value():b,d,e,f,g);if(!n)return!1}f||(f=[]),g||(g=[]);for(var q=f.length;q--;)if(f[q]==a)return g[q]==b;f.push(a),g.push(b);var r=(h?yc:Ac)(a,b,c,d,e,f,g);return f.pop(),g.pop(),r}function Eb(a,b,c,d,e){for(var f=-1,g=b.length,h=!e;++f<g;)if(h&&d[f]?c[f]!==a[b[f]]:!(b[f]in a))return!1;for(f=-1;++f<g;){var i=b[f],j=a[i],k=c[f];if(h&&d[f])var l="undefined"!=typeof j||i in a;else l=e?e(j,k,i):w,"undefined"==typeof l&&(l=Cb(k,j,e,!0));if(!l)return!1}return!0}function Fb(a,b){var c=[];return qg(a,function(a,d,e){c.push(b(a,d,e))}),c}function Gb(a){var b=rh(a),c=b.length;if(!c)return _e(!0);if(1==c){var d=b[0],e=a[d];if(Mc(e))return function(a){return null!=a&&a[d]===e&&("undefined"!=typeof e||d in Uc(a))}}for(var f=of(c),g=of(c);c--;)e=a[b[c]],f[c]=e,g[c]=Mc(e);return function(a){return null!=a&&Eb(Uc(a),b,f,g)}}function Hb(a,b){return Mc(b)?function(c){return null!=c&&c[a]===b&&("undefined"!=typeof b||a in Uc(c))}:function(c){return null!=c&&Cb(b,c[a],null,!0)}}function Ib(a,b,c,d,e){if(!le(a))return a;var f=Lc(b.length)&&(fh(b)||te(b));return(f?_a:zb)(b,function(b,g,h){if(o(b))return d||(d=[]),e||(e=[]),Jb(a,h,g,Ib,c,d,e);var i=a[g],j=c?c(i,b,g,a,h):w,k="undefined"==typeof j;k&&(j=b),(f||"undefined"!=typeof j)&&(k||(j===j?j!==i:i===i))&&(a[g]=j)}),a}function Jb(a,b,c,d,e,f,g){for(var h=f.length,i=b[c];h--;)if(f[h]==i)return void(a[c]=g[h]);var j=a[c],k=e?e(j,i,c,a,b):w,l="undefined"==typeof k;l&&(k=i,Lc(i.length)&&(fh(i)||te(i))?k=fh(j)?j:j&&j.length?$a(j):[]:ih(i)||ee(i)?k=ee(j)?we(j):ih(j)?j:{}:l=!1),f.push(i),g.push(k),l?a[c]=d(k,i,e,f,g):(k===k?k!==j:j===j)&&(a[c]=k)}function Kb(a){return function(b){return null==b?w:b[a]}}function Lb(a,b){return a+Nf(eg()*(b-a+1))}function Mb(a,b,c,d,e){return e(a,function(a,e,f){c=d?(d=!1,a):b(c,a,e,f)}),c}function Nb(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c="undefined"==typeof c||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=of(e);++d<e;)f[d]=a[d+b];return f}function Ob(a,b){var c;return qg(a,function(a,d,e){return c=b(a,d,e),!c}),!!c}function Pb(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function Qb(a,b,c){var d=-1,e=a.length,f=Lc(e)?of(e):[];return qg(a,function(a){for(var c=b.length,e=of(c);c--;)e[c]=null==a?w:a[b[c]];f[++d]={criteria:e,index:d,value:a}}),Pb(f,function(a,b){return j(a,b,c)})}function Rb(a,b){var c=0;return qg(a,function(a,d,e){c+=+b(a,d,e)||0}),c}function Sb(a,b){var d=-1,e=Dc(),f=a.length,g=e==c,h=g&&f>=200,i=h?vg():null,j=[];i?(e=Wa,g=!1):(h=!1,i=b?[]:j);a:for(;++d<f;){var k=a[d],l=b?b(k,d,a):k;if(g&&k===k){for(var m=i.length;m--;)if(i[m]===l)continue a;b&&i.push(l),j.push(k)}else e(i,l,0)<0&&((b||h)&&i.push(l),j.push(k))}return j}function Tb(a,b){for(var c=-1,d=b.length,e=of(d);++c<d;)e[c]=a[b[c]];return e}function Ub(a,b,c,d){for(var e=a.length,f=d?e:-1;(d?f--:++f<e)&&b(a[f],f,a););return c?Nb(a,d?0:f,d?f+1:e):Nb(a,d?f+1:0,d?e:f)}function Vb(a,b){var c=a;c instanceof Ma&&(c=c.value());for(var d=-1,e=b.length;++d<e;){var f=[c],g=b[d];Pf.apply(f,g.args),c=g.func.apply(g.thisArg,f)}return c}function Wb(a,b,c){var d=0,e=a?a.length:d;if("number"==typeof b&&b===b&&jg>=e){for(;e>d;){var f=d+e>>>1,g=a[f];(c?b>=g:b>g)?d=f+1:e=f}return e}return Xb(a,b,af,c)}function Xb(a,b,c,d){b=c(b);for(var e=0,f=a?a.length:0,g=b!==b,h="undefined"==typeof b;f>e;){var i=Nf((e+f)/2),j=c(a[i]),k=j===j;if(g)var l=k||d;else l=h?k&&(d||"undefined"!=typeof j):d?b>=j:b>j;l?e=i+1:f=i}return ag(f,ig)}function Yb(a,b,c){if("function"!=typeof a)return af;if("undefined"==typeof b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function Zb(a){return Kf.call(a,0)}function $b(a,b,c){for(var d=c.length,e=-1,f=_f(a.length-d,0),g=-1,h=b.length,i=of(f+h);++g<h;)i[g]=b[g];for(;++e<d;)i[c[e]]=a[e];for(;f--;)i[g++]=a[e++];return i}function _b(a,b,c){for(var d=-1,e=c.length,f=-1,g=_f(a.length-e,0),h=-1,i=b.length,j=of(g+i);++f<g;)j[f]=a[f];for(var k=f;++h<i;)j[k+h]=b[h];for(;++d<e;)j[k+c[d]]=a[f++];return j}function ac(a,b){return function(c,d,e){var f=b?b():{};if(d=Cc(d,e,3),fh(c))for(var g=-1,h=c.length;++g<h;){var i=c[g];a(f,i,d(i,g,c),c)}else qg(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function bc(a){return function(){var b=arguments,c=b.length,d=b[0];if(2>c||null==d)return d;var e=b[c-2],f=b[c-1],g=b[3];c>3&&"function"==typeof e?(e=Yb(e,f,5),c-=2):(e=c>2&&"function"==typeof f?f:null,c-=e?1:0),g&&Jc(b[1],b[2],g)&&(e=3==c?null:e,c=2);for(var h=0;++h<c;){var i=b[h];i&&a(d,i,e)}return d}}function cc(a,b){return function(c,d){var e=c?c.length:0;if(!Lc(e))return a(c,d);for(var f=b?e:-1,g=Uc(c);(b?f--:++f<e)&&d(g[f],f,g)!==!1;);return c}}function dc(a){return function(b,c,d){for(var e=Uc(b),f=d(b),g=f.length,h=a?g:-1;a?h--:++h<g;){var i=f[h];if(c(e[i],i,e)===!1)break}return b}}function ec(a,b){function c(){var e=this&&this!==Xa&&this instanceof c?d:a;return e.apply(b,arguments)}var d=gc(a);return c}function fc(a){return function(b){for(var c=-1,d=Ze(Le(b)),e=d.length,f="";++c<e;)f=a(f,d[c],c);return f}}function gc(a){return function(){var b=pg(a.prototype),c=a.apply(b,arguments);return le(c)?c:b}}function hc(a){function b(c,d,e){e&&Jc(c,d,e)&&(d=null);var f=xc(c,a,null,null,null,null,null,d);return f.placeholder=b.placeholder,f}return b}function ic(a,b){return function(c,d,e){e&&Jc(c,d,e)&&(d=null);var g=Cc(),h=null==d;if(g===pb&&h||(h=!1,d=g(d,e,3)),h){var i=fh(c);if(i||!se(c))return a(i?c:Tc(c));d=f}return Bc(c,d,b)}}function jc(a,c){return function(d,e,f){if(e=Cc(e,f,3),fh(d)){var g=b(d,e,c);return g>-1?d[g]:w}return wb(d,e,a)}}function kc(a){return function(c,d,e){return c&&c.length?(d=Cc(d,e,3),b(c,d,a)):-1}}function lc(a){return function(b,c,d){return c=Cc(c,d,3),wb(b,c,a,!0)}}function mc(a){return function(){var b=arguments.length;if(!b)return function(){return arguments[0]};for(var c,d=a?b:-1,e=0,f=of(b);a?d--:++d<b;){var g=f[e++]=arguments[d];if("function"!=typeof g)throw new xf(O);var h=c?"":xg(g);c="wrapper"==h?new aa([]):c}for(d=c?-1:b;++d<b;){g=f[d],h=xg(g);var i="wrapper"==h?wg(g):null;c=i&&Kc(i[0])?c[xg(i[0])].apply(c,i[3]):1==g.length&&Kc(g)?c[h]():c.thru(g)}return function(){var a=arguments;if(c&&1==a.length&&fh(a[0]))return c.plant(a[0]).value();for(var d=0,e=f[d].apply(this,a);++d<b;)e=f[d].call(this,e);return e}}}function nc(a,b){return function(c,d,e){return"function"==typeof d&&"undefined"==typeof e&&fh(c)?a(c,d):b(c,Yb(d,e,3))}}function oc(a){return function(b,c,d){return("function"!=typeof c||"undefined"!=typeof d)&&(c=Yb(c,d,3)),a(b,c,Be)}}function pc(a){return function(b,c,d){return("function"!=typeof c||"undefined"!=typeof d)&&(c=Yb(c,d,3)),a(b,c)}}function qc(a){return function(b,c,d){return b=e(b),b&&(a?b:"")+uc(b,c,d)+(a?"":b)}}function rc(a){var b=$d(function(c,d){var e=q(d,b.placeholder);return xc(c,a,null,d,e)});return b}function sc(a,b){return function(c,d,e,f){var g=arguments.length<3;return"function"==typeof d&&"undefined"==typeof f&&fh(c)?a(c,d,e,g):Mb(c,Cc(d,f,4),e,g,b)}}function tc(a,b,c,d,e,f,g,h,i,j){function k(){for(var u=arguments.length,v=u,x=of(u);v--;)x[v]=arguments[v];if(d&&(x=$b(x,d,e)),f&&(x=_b(x,f,g)),o||r){var A=k.placeholder,B=q(x,A);if(u-=B.length,j>u){var C=h?$a(h):null,F=_f(j-u,0),G=o?B:null,H=o?null:B,I=o?x:null,J=o?null:x;b|=o?D:E,b&=~(o?E:D),p||(b&=~(y|z));var K=[a,b,c,I,G,J,H,C,i,F],L=tc.apply(w,K);return Kc(a)&&yg(L,K),L.placeholder=A,L}}var M=m?c:this;n&&(a=M[t]),h&&(x=Qc(x,h)),l&&i<x.length&&(x.length=i);var N=this&&this!==Xa&&this instanceof k?s||gc(a):a;return N.apply(M,x)}var l=b&F,m=b&y,n=b&z,o=b&B,p=b&A,r=b&C,s=!n&&gc(a),t=a;return k}function uc(a,b,c){var d=a.length;if(b=+b,d>=b||!Zf(b))return"";var e=b-d;return c=null==c?" ":c+"",Re(c,Lf(e/c.length)).slice(0,e)}function vc(a,b,c,d){function e(){for(var b=-1,h=arguments.length,i=-1,j=d.length,k=of(h+j);++i<j;)k[i]=d[i];for(;h--;)k[i++]=arguments[++b];var l=this&&this!==Xa&&this instanceof e?g:a;return l.apply(f?c:this,k)}var f=b&y,g=gc(a);return e}function wc(a){return function(b,c,d,e){var f=Cc(d);return f===pb&&null==d?Wb(b,c,a):Xb(b,c,f(d,e,1),a)}}function xc(a,b,c,d,e,f,g,h){var i=b&z;if(!i&&"function"!=typeof a)throw new xf(O);var j=d?d.length:0;if(j||(b&=~(D|E),d=e=null),j-=e?e.length:0,b&E){var k=d,l=e;d=e=null}var m=i?null:wg(a),n=[a,b,c,d,e,k,l,f,g,h];if(m&&(Nc(n,m),b=n[1],h=n[9]),n[9]=null==h?i?0:a.length:_f(h-j,0)||0,b==y)var o=ec(n[0],n[2]);else o=b!=D&&b!=(y|D)||n[4].length?tc.apply(w,n):vc.apply(w,n);var p=m?ug:yg;return p(o,n)}function yc(a,b,c,d,e,f,g){var h=-1,i=a.length,j=b.length,k=!0;if(i!=j&&!(e&&j>i))return!1;for(;k&&++h<i;){var l=a[h],m=b[h];if(k=w,d&&(k=e?d(m,l,h):d(l,m,h)),"undefined"==typeof k)if(e)for(var n=j;n--&&(m=b[n],!(k=l&&l===m||c(l,m,d,e,f,g))););else k=l&&l===m||c(l,m,d,e,f,g)}return!!k}function zc(a,b,c){switch(c){case S:case T:return+a==+b;case U:return a.name==b.name&&a.message==b.message;case X:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case Z:case _:return a==b+""}return!1}function Ac(a,b,c,d,e,f,g){var h=rh(a),i=h.length,j=rh(b),k=j.length;if(i!=k&&!e)return!1;for(var l=e,m=-1;++m<i;){var n=h[m],o=e?n in b:Ef.call(b,n);if(o){var p=a[n],q=b[n];o=w,d&&(o=e?d(q,p,n):d(p,q,n)),"undefined"==typeof o&&(o=p&&p===q||c(p,q,d,e,f,g))}if(!o)return!1;l||(l="constructor"==n)}if(!l){var r=a.constructor,s=b.constructor;if(r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s))return!1}return!0}function Bc(a,b,c){var d=c?gg:fg,e=d,f=e;return qg(a,function(a,g,h){var i=b(a,g,h);((c?e>i:i>e)||i===d&&i===f)&&(e=i,f=a)}),f}function Cc(a,b,c){var d=W.callback||$e;return d=d===$e?pb:d,c?d(a,b,c):d}function Dc(a,b,d){var e=W.indexOf||ed;return e=e===ed?c:e,a?e(a,b,d):e}function Ec(a,b,c){for(var d=-1,e=c?c.length:0;++d<e;){var f=c[d],g=f.size;switch(f.type){case"drop":a+=g;break;case"dropRight":b-=g;break;case"take":b=ag(b,a+g);break;case"takeRight":a=_f(a,b-g)}}return{start:a,end:b}}function Fc(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&Ef.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function Gc(a){var b=a.constructor;return"function"==typeof b&&b instanceof b||(b=uf),new b}function Hc(a,b,c){var d=a.constructor;switch(b){case ba:return Zb(a);case S:case T:return new d(+a);case ca:case da:case ea:case fa:case ga:case ha:case ia:case ja:case ka:var e=a.buffer;return new d(c?Zb(e):e,a.byteOffset,a.length);case X:case _:return new d(a);case Z:var f=new d(a.source,xa.exec(a));f.lastIndex=a.lastIndex}return f}function Ic(a,b){return a=+a,b=null==b?lg:b,a>-1&&a%1==0&&b>a}function Jc(a,b,c){if(!le(c))return!1;var d=typeof b;if("number"==d)var e=c.length,f=Lc(e)&&Ic(b,e);else f="string"==d&&b in c;if(f){var g=c[b];return a===a?a===g:g!==g}return!1}function Kc(a){var b=xg(a);return!!b&&a===W[b]&&b in Ma.prototype}function Lc(a){return"number"==typeof a&&a>-1&&a%1==0&&lg>=a}function Mc(a){return a===a&&(0===a?1/a>0:!le(a))}function Nc(a,b){var c=a[1],d=b[1],e=c|d,f=F>e,g=d==F&&c==B||d==F&&c==G&&a[7].length<=b[8]||d==(F|G)&&c==B;if(!f&&!g)return a;d&y&&(a[2]=b[2],e|=c&y?0:A);var h=b[3];if(h){var i=a[3];a[3]=i?$b(i,h,b[4]):$a(h),a[4]=i?q(a[3],P):$a(b[4])}return h=b[5],h&&(i=a[5],a[5]=i?_b(i,h,b[6]):$a(h),a[6]=i?q(a[5],P):$a(b[6])),h=b[7],h&&(a[7]=$a(h)),d&F&&(a[8]=null==a[8]?b[8]:ag(a[8],b[8])),null==a[9]&&(a[9]=b[9]),a[0]=b[0],a[1]=e,a}function Oc(a,b){a=Uc(a);for(var c=-1,d=b.length,e={};++c<d;){var f=b[c];f in a&&(e[f]=a[f])}return e}function Pc(a,b){var c={};return yb(a,function(a,d,e){b(a,d,e)&&(c[d]=a)}),c}function Qc(a,b){for(var c=a.length,d=ag(b.length,c),e=$a(a);d--;){var f=b[d];a[d]=Ic(f,c)?e[f]:w}return a}function Rc(a){{var b;W.support}if(!o(a)||Gf.call(a)!=Y||!Ef.call(a,"constructor")&&(b=a.constructor,"function"==typeof b&&!(b instanceof b)))return!1;var c;return yb(a,function(a,b){c=b}),"undefined"==typeof c||Ef.call(a,c)}function Sc(a){for(var b=Be(a),c=b.length,d=c&&a.length,e=W.support,f=d&&Lc(d)&&(fh(a)||e.nonEnumArgs&&ee(a)),g=-1,h=[];++g<c;){var i=b[g];(f&&Ic(i,d)||Ef.call(a,i))&&h.push(i)}return h}function Tc(a){return null==a?[]:Lc(a.length)?le(a)?a:uf(a):Ge(a)}function Uc(a){return le(a)?a:uf(a)}function Vc(a){return a instanceof Ma?a.clone():new aa(a.__wrapped__,a.__chain__,$a(a.__actions__))}function Wc(a,b,c){b=(c?Jc(a,b,c):null==b)?1:_f(+b||1,1);for(var d=0,e=a?a.length:0,f=-1,g=of(Lf(e/b));e>d;)g[++f]=Nb(a,d,d+=b);return g}function Xc(a){for(var b=-1,c=a?a.length:0,d=-1,e=[];++b<c;){var f=a[b];f&&(e[++d]=f)}return e}function Yc(a,b,c){var d=a?a.length:0;return d?((c?Jc(a,b,c):null==b)&&(b=1),Nb(a,0>b?0:b)):[]}function Zc(a,b,c){var d=a?a.length:0;return d?((c?Jc(a,b,c):null==b)&&(b=1),b=d-(+b||0),Nb(a,0,0>b?0:b)):[]}function $c(a,b,c){return a&&a.length?Ub(a,Cc(b,c,3),!0,!0):[]}function _c(a,b,c){return a&&a.length?Ub(a,Cc(b,c,3),!0):[]}function ad(a,b,c,d){var e=a?a.length:0;return e?(c&&"number"!=typeof c&&Jc(a,b,c)&&(c=0,d=e),ub(a,b,c,d)):[]}function bd(a){return a?a[0]:w}function cd(a,b,c){var d=a?a.length:0;return c&&Jc(a,b,c)&&(b=!1),d?xb(a,b):[]}function dd(a){var b=a?a.length:0;return b?xb(a,!0):[]}function ed(a,b,d){var e=a?a.length:0;if(!e)return-1;if("number"==typeof d)d=0>d?_f(e+d,0):d;else if(d){var f=Wb(a,b),g=a[f];return(b===b?b===g:g!==g)?f:-1}return c(a,b,d||0)}function fd(a){return Zc(a,1)}function gd(){for(var a=[],b=-1,d=arguments.length,e=[],f=Dc(),g=f==c;++b<d;){var h=arguments[b];(fh(h)||ee(h))&&(a.push(h),e.push(g&&h.length>=120?vg(b&&h):null))}d=a.length;var i=a[0],j=-1,k=i?i.length:0,l=[],m=e[0];a:for(;++j<k;)if(h=i[j],(m?Wa(m,h):f(l,h,0))<0){for(b=d;--b;){var n=e[b];if((n?Wa(n,h):f(a[b],h,0))<0)continue a}m&&m.push(h),l.push(h)}return l}function hd(a){var b=a?a.length:0;return b?a[b-1]:w}function id(a,b,c){var d=a?a.length:0;if(!d)return-1;var e=d;if("number"==typeof c)e=(0>c?_f(d+c,0):ag(c||0,d-1))+1;else if(c){e=Wb(a,b,!0)-1;var f=a[e];return(b===b?b===f:f!==f)?e:-1}if(b!==b)return n(a,e,!0);for(;e--;)if(a[e]===b)return e;return-1}function jd(){var a=arguments,b=a[0];if(!b||!b.length)return b;for(var c=0,d=Dc(),e=a.length;++c<e;)for(var f=0,g=a[c];(f=d(b,g,f))>-1;)Tf.call(b,f,1);return b}function kd(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=Cc(b,c,3);++d<e;){var g=a[d];b(g,d,a)&&(f.push(g),Tf.call(a,d--,1),e--)}return f}function ld(a){return Yc(a,1)}function md(a,b,c){var d=a?a.length:0;return d?(c&&"number"!=typeof c&&Jc(a,b,c)&&(b=0,c=d),Nb(a,b,c)):[]}function nd(a,b,c){var d=a?a.length:0;return d?((c?Jc(a,b,c):null==b)&&(b=1),Nb(a,0,0>b?0:b)):[]}function od(a,b,c){var d=a?a.length:0;return d?((c?Jc(a,b,c):null==b)&&(b=1),b=d-(+b||0),Nb(a,0>b?0:b)):[]}function pd(a,b,c){return a&&a.length?Ub(a,Cc(b,c,3),!1,!0):[]}function qd(a,b,c){return a&&a.length?Ub(a,Cc(b,c,3)):[]}function rd(a,b,d,e){var f=a?a.length:0;if(!f)return[];null!=b&&"boolean"!=typeof b&&(e=d,d=Jc(a,b,e)?null:b,b=!1);var g=Cc();return(g!==pb||null!=d)&&(d=g(d,e,3)),b&&Dc()==c?r(a,d):Sb(a,d)}function sd(a){for(var b=-1,c=(a&&a.length&&eb(db(a,Df)))>>>0,d=of(c);++b<c;)d[b]=db(a,Kb(b));return d}function td(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(fh(c)||ee(c))var d=d?sb(d,c).concat(sb(c,d)):c}return d?Sb(d):[]}function ud(a,b){var c=-1,d=a?a.length:0,e={};for(d&&!b&&!fh(a[0])&&(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function vd(a){var b=W(a);return b.__chain__=!0,b}function wd(a,b,c){return b.call(c,a),a}function xd(a,b,c){return b.call(c,a)}function yd(){return vd(this)}function zd(){return new aa(this.value(),this.__chain__)}function Ad(a){for(var b,c=this;c instanceof $;){var d=Vc(c);b?e.__wrapped__=d:b=d;var e=d;c=c.__wrapped__}return e.__wrapped__=a,b}function Bd(){var a=this.__wrapped__;return a instanceof Ma?(this.__actions__.length&&(a=new Ma(this)),new aa(a.reverse(),this.__chain__)):this.thru(function(a){return a.reverse()})}function Cd(){return this.value()+""}function Dd(){return Vb(this.__wrapped__,this.__actions__)}function Ed(a,b,c){var d=fh(a)?bb:tb;return c&&Jc(a,b,c)&&(b=null),("function"!=typeof b||"undefined"!=typeof c)&&(b=Cc(b,c,3)),d(a,b)}function Fd(a,b,c){var d=fh(a)?cb:vb;return b=Cc(b,c,3),d(a,b)}function Gd(a,b){return Kg(a,Gb(b))}function Hd(a,b,c,d){var e=a?a.length:0;return Lc(e)||(a=Ge(a),e=a.length),e?(c="number"!=typeof c||d&&Jc(b,c,d)?0:0>c?_f(e+c,0):c||0,"string"==typeof a||!fh(a)&&se(a)?e>c&&a.indexOf(b,c)>-1:Dc(a,b,c)>-1):!1}function Id(a,b,c){var d=fh(a)?db:Fb;return b=Cc(b,c,3),d(a,b)}function Jd(a,b){return Id(a,Kb(b))}function Kd(a,b,c){var d=fh(a)?cb:vb;return b=Cc(b,c,3),d(a,function(a,c,d){return!b(a,c,d)})}function Ld(a,b,c){if(c?Jc(a,b,c):null==b){a=Tc(a);var d=a.length;return d>0?a[Lb(0,d-1)]:w}var e=Md(a);return e.length=ag(0>b?0:+b||0,e.length),e}function Md(a){a=Tc(a);for(var b=-1,c=a.length,d=of(c);++b<c;){var e=Lb(0,b);b!=e&&(d[b]=d[e]),d[e]=a[b]}return d}function Nd(a){var b=a?a.length:0;return Lc(b)?b:rh(a).length}function Od(a,b,c){var d=fh(a)?ib:Ob;return c&&Jc(a,b,c)&&(b=null),("function"!=typeof b||"undefined"!=typeof c)&&(b=Cc(b,c,3)),d(a,b)}function Pd(a,b,c){if(null==a)return[];var d=-1,e=a.length,f=Lc(e)?of(e):[];return c&&Jc(a,b,c)&&(b=null),b=Cc(b,c,3),qg(a,function(a,c,e){f[++d]={criteria:b(a,c,e),index:d,value:a}}),Pb(f,i)}function Qd(){var a=arguments,b=a[0],c=a[3],d=0,e=a.length-1;if(null==b)return[];for(var f=of(e);e>d;)f[d]=a[++d];return c&&Jc(a[1],a[2],c)&&(f=a[1]),Qb(b,xb(f),[])}function Rd(a,b,c,d){return null==a?[]:(d&&Jc(b,c,d)&&(c=null),fh(b)||(b=null==b?[]:[b]),fh(c)||(c=null==c?[]:[c]),Qb(a,b,c))}function Sd(a,b){return Fd(a,Gb(b))}function Td(a,b){if("function"!=typeof b){if("function"!=typeof a)throw new xf(O);var c=a;a=b,b=c}return a=Zf(a=+a)?a:0,function(){return--a<1?b.apply(this,arguments):void 0}}function Ud(a,b,c){return c&&Jc(a,b,c)&&(b=null),b=a&&null==b?a.length:_f(+b||0,0),xc(a,F,null,null,null,null,b)}function Vd(a,b){var c;if("function"!=typeof b){if("function"!=typeof a)throw new xf(O);var d=a;a=b,b=d}return function(){return--a>0?c=b.apply(this,arguments):b=null,c}}function Wd(a,b,c){function d(){m&&Mf(m),i&&Mf(i),i=m=n=w}function e(){var c=b-(Ug()-k);if(0>=c||c>b){i&&Mf(i);var d=n;i=m=n=w,d&&(o=Ug(),j=a.apply(l,h),!m&&!i&&(h=l=null))}else m=Sf(e,c)}function f(){m&&Mf(m),i=m=n=w,(q||p!==b)&&(o=Ug(),j=a.apply(l,h),!m&&!i&&(h=l=null))}function g(){if(h=arguments,k=Ug(),l=this,n=q&&(m||!r),p===!1)var c=r&&!m;else{!i&&!r&&(o=k);var d=p-(k-o),g=0>=d||d>p;g?(i&&(i=Mf(i)),o=k,j=a.apply(l,h)):i||(i=Sf(f,d))}return g&&m?m=Mf(m):!m&&b!==p&&(m=Sf(e,b)),c&&(g=!0,j=a.apply(l,h)),g&&!m&&!i&&(h=l=null),j}var h,i,j,k,l,m,n,o=0,p=!1,q=!0;if("function"!=typeof a)throw new xf(O);if(b=0>b?0:+b||0,c===!0){var r=!0;q=!1}else le(c)&&(r=c.leading,p="maxWait"in c&&_f(+c.maxWait||0,b),q="trailing"in c?c.trailing:q);return g.cancel=d,g}function Xd(a,b){if("function"!=typeof a||b&&"function"!=typeof b)throw new xf(O);var c=function(){var d=arguments,e=c.cache,f=b?b.apply(this,d):d[0];if(e.has(f))return e.get(f);var g=a.apply(this,d);return e.set(f,g),g};return c.cache=new Xd.Cache,c}function Yd(a){if("function"!=typeof a)throw new xf(O);return function(){return!a.apply(this,arguments)}}function Zd(a){return Vd(a,2)}function $d(a,b){if("function"!=typeof a)throw new xf(O);return b=_f("undefined"==typeof b?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=_f(c.length-b,0),f=of(e);++d<e;)f[d]=c[b+d];switch(b){case 0:return a.call(this,f);case 1:return a.call(this,c[0],f);case 2:return a.call(this,c[0],c[1],f)}var g=of(b+1);for(d=-1;++d<b;)g[d]=c[d];return g[b]=f,a.apply(this,g)}}function _d(a){if("function"!=typeof a)throw new xf(O);return function(b){return a.apply(this,b)}}function ae(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new xf(O);return c===!1?d=!1:le(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),La.leading=d,La.maxWait=+b,La.trailing=e,Wd(a,b,La)}function be(a,b){return b=null==b?af:b,xc(b,D,null,[a],[])}function ce(a,b,c,d){return b&&"boolean"!=typeof b&&Jc(a,b,c)?b=!1:"function"==typeof b&&(d=c,c=b,b=!1),c="function"==typeof c&&Yb(c,d,1),qb(a,b,c)}function de(a,b,c){return b="function"==typeof b&&Yb(b,c,1),qb(a,!0,b)}function ee(a){var b=o(a)?a.length:w;return Lc(b)&&Gf.call(a)==Q}function fe(a){return a===!0||a===!1||o(a)&&Gf.call(a)==S}function ge(a){return o(a)&&Gf.call(a)==T}function he(a){return!!a&&1===a.nodeType&&o(a)&&Gf.call(a).indexOf("Element")>-1}function ie(a){if(null==a)return!0;var b=a.length;return Lc(b)&&(fh(a)||se(a)||ee(a)||o(a)&&hh(a.splice))?!b:!rh(a).length}function je(a,b,c,d){if(c="function"==typeof c&&Yb(c,d,3),!c&&Mc(a)&&Mc(b))return a===b;var e=c?c(a,b):w;return"undefined"==typeof e?Cb(a,b,c):!!e}function ke(a){return o(a)&&"string"==typeof a.message&&Gf.call(a)==U}function le(a){var b=typeof a;return"function"==b||!!a&&"object"==b}function me(a,b,c,d){var e=rh(b),f=e.length;if(!f)return!0;if(null==a)return!1;if(c="function"==typeof c&&Yb(c,d,3),!c&&1==f){var g=e[0],h=b[g];if(Mc(h))return h===a[g]&&("undefined"!=typeof h||g in Uc(a))}for(var i=of(f),j=of(f);f--;)h=i[f]=b[e[f]],j[f]=Mc(h);return Eb(Uc(a),e,i,j,c)}function ne(a){return qe(a)&&a!=+a}function oe(a){return null==a?!1:Gf.call(a)==V?If.test(Cf.call(a)):o(a)&&za.test(a)}function pe(a){return null===a}function qe(a){return"number"==typeof a||o(a)&&Gf.call(a)==X}function re(a){return o(a)&&Gf.call(a)==Z||!1}function se(a){return"string"==typeof a||o(a)&&Gf.call(a)==_}function te(a){return o(a)&&Lc(a.length)&&!!Ja[Gf.call(a)]}function ue(a){return"undefined"==typeof a}function ve(a){var b=a?a.length:0;return Lc(b)?b?$a(a):[]:Ge(a)}function we(a){return ob(a,Be(a))}function xe(a,b,c){var d=pg(a);return c&&Jc(a,b,c)&&(b=null),b?ob(b,d,rh(b)):d}function ye(a){return Bb(a,Be(a))}function ze(a,b){return a?Ef.call(a,b):!1}function Ae(a,b,c){c&&Jc(a,b,c)&&(b=null);for(var d=-1,e=rh(a),f=e.length,g={};++d<f;){var h=e[d],i=a[h];b?Ef.call(g,i)?g[i].push(h):g[i]=[h]:g[i]=h}return g}function Be(a){if(null==a)return[];le(a)||(a=uf(a));var b=a.length;b=b&&Lc(b)&&(fh(a)||og.nonEnumArgs&&ee(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,f=of(b),g=b>0;++d<b;)f[d]=d+"";for(var h in a)!(g&&Ic(h,b)||"constructor"==h&&(e||!Ef.call(a,h))||!f.push(h));return f}function Ce(a,b,c){var d={};return b=Cc(b,c,3),zb(a,function(a,c,e){d[c]=b(a,c,e)}),d}function De(a){for(var b=-1,c=rh(a),d=c.length,e=of(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Ee(a,b,c){var d=null==a?w:a[b];return"undefined"==typeof d&&(d=c),hh(d)?d.call(a):d}function Fe(a,b,c,d){var e=fh(a)||te(a);if(b=Cc(b,d,4),null==c)if(e||le(a)){var f=a.constructor;c=e?fh(a)?new f:[]:pg(hh(f)&&f.prototype)}else c={};return(e?_a:zb)(a,function(a,d,e){return b(c,a,d,e)}),c}function Ge(a){return Tb(a,rh(a))}function He(a){return Tb(a,Be(a))}function Ie(a,b,c){return b=+b||0,"undefined"==typeof c?(c=b,b=0):c=+c||0,a>=b&&c>a}function Je(a,b,c){c&&Jc(a,b,c)&&(b=c=null);var d=null==a,e=null==b;if(null==c&&(e&&"boolean"==typeof a?(c=a,a=1):"boolean"==typeof b&&(c=b,e=!0)),d&&e&&(b=1,e=!1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=eg();return ag(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return Lb(a,b)}function Ke(a){return a=e(a),a&&a.charAt(0).toUpperCase()+a.slice(1)}function Le(a){return a=e(a),a&&a.replace(Aa,k).replace(va,"")}function Me(a,b,c){a=e(a),b+="";var d=a.length;return c="undefined"==typeof c?d:ag(0>c?0:+c||0,d),c-=b.length,c>=0&&a.indexOf(b,c)==c}function Ne(a){return a=e(a),a&&ra.test(a)?a.replace(pa,l):a}function Oe(a){return a=e(a),a&&Da.test(a)?a.replace(Ca,"\\$&"):a}function Pe(a,b,c){a=e(a),b=+b;var d=a.length;if(d>=b||!Zf(b))return a;var f=(b-d)/2,g=Nf(f),h=Lf(f);return c=uc("",h,c),c.slice(0,g)+a+c}function Qe(a,b,c){return c&&Jc(a,b,c)&&(b=0),dg(a,b)}function Re(a,b){var c="";if(a=e(a),b=+b,1>b||!a||!Zf(b))return c;do b%2&&(c+=a),b=Nf(b/2),a+=a;while(b);return c}function Se(a,b,c){return a=e(a),c=null==c?0:ag(0>c?0:+c||0,a.length),a.lastIndexOf(b,c)==c}function Te(a,b,c){var d=W.templateSettings;c&&Jc(a,b,c)&&(b=c=null),a=e(a),b=mb(mb({},c||b),d,lb);var f,g,h=mb(mb({},b.imports),d.imports,lb),i=rh(h),j=Tb(h,i),k=0,l=b.interpolate||Ba,n="__p += '",o=vf((b.escape||Ba).source+"|"+l.source+"|"+(l===ua?wa:Ba).source+"|"+(b.evaluate||Ba).source+"|$","g"),p="//# sourceURL="+("sourceURL"in b?b.sourceURL:"lodash.templateSources["+ ++Ia+"]")+"\n";a.replace(o,function(b,c,d,e,h,i){return d||(d=e),n+=a.slice(k,i).replace(Ea,m),c&&(f=!0,n+="' +\n__e("+c+") +\n'"),h&&(g=!0,n+="';\n"+h+";\n__p += '"),d&&(n+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=i+b.length,b}),n+="';\n";var q=b.variable;q||(n="with (obj) {\n"+n+"\n}\n"),n=(g?n.replace(la,""):n).replace(ma,"$1").replace(na,"$1;"),n="function("+(q||"obj")+") {\n"+(q?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(f?", __e = _.escape":"")+(g?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+n+"return __p\n}";var r=Bh(function(){return rf(i,p+"return "+n).apply(w,j)});if(r.source=n,ke(r))throw r;return r}function Ue(a,b,c){var d=a;return a=e(a),a?(c?Jc(d,b,c):null==b)?a.slice(s(a),t(a)+1):(b+="",a.slice(g(a,b),h(a,b)+1)):a}function Ve(a,b,c){var d=a;return a=e(a),a?a.slice((c?Jc(d,b,c):null==b)?s(a):g(a,b+"")):a}function We(a,b,c){var d=a;return a=e(a),a?(c?Jc(d,b,c):null==b)?a.slice(0,t(a)+1):a.slice(0,h(a,b+"")+1):a}function Xe(a,b,c){c&&Jc(a,b,c)&&(b=null);var d=H,f=I;if(null!=b)if(le(b)){var g="separator"in b?b.separator:g;d="length"in b?+b.length||0:d,f="omission"in b?e(b.omission):f}else d=+b||0;if(a=e(a),d>=a.length)return a;var h=d-f.length;if(1>h)return f;var i=a.slice(0,h);if(null==g)return i+f;if(re(g)){if(a.slice(h).search(g)){var j,k,l=a.slice(0,h);for(g.global||(g=vf(g.source,(xa.exec(g)||"")+"g")),g.lastIndex=0;j=g.exec(l);)k=j.index;i=i.slice(0,null==k?h:k)}}else if(a.indexOf(g,h)!=h){
var m=i.lastIndexOf(g);m>-1&&(i=i.slice(0,m))}return i+f}function Ye(a){return a=e(a),a&&qa.test(a)?a.replace(oa,u):a}function Ze(a,b,c){return c&&Jc(a,b,c)&&(b=null),a=e(a),a.match(b||Fa)||[]}function $e(a,b,c){return c&&Jc(a,b,c)&&(b=null),o(a)?bf(a):pb(a,b)}function _e(a){return function(){return a}}function af(a){return a}function bf(a){return Gb(qb(a,!0))}function cf(a,b){return Hb(a+"",qb(b,!0))}function df(a,b,c){if(null==c){var d=le(b),e=d&&rh(b),f=e&&e.length&&Bb(b,e);(f?f.length:d)||(f=!1,c=b,b=a,a=this)}f||(f=Bb(b,rh(b)));var g=!0,h=-1,i=hh(a),j=f.length;c===!1?g=!1:le(c)&&"chain"in c&&(g=c.chain);for(;++h<j;){var k=f[h],l=b[k];a[k]=l,i&&(a.prototype[k]=function(b){return function(){var c=this.__chain__;if(g||c){var d=a(this.__wrapped__),e=d.__actions__=$a(this.__actions__);return e.push({func:b,args:arguments,thisArg:a}),d.__chain__=c,d}var f=[this.value()];return Pf.apply(f,arguments),b.apply(a,f)}}(l))}return a}function ef(){return p._=Hf,this}function ff(){}function gf(a){return Kb(a+"")}function hf(a){return function(b){return null==a?w:a[b]}}function jf(a,b,c){c&&Jc(a,b,c)&&(b=c=null),a=+a||0,c=null==c?1:+c||0,null==b?(b=a,a=0):b=+b||0;for(var d=-1,e=_f(Lf((b-a)/(c||1)),0),f=of(e);++d<e;)f[d]=a,a+=c;return f}function kf(a,b,c){if(a=+a,1>a||!Zf(a))return[];var d=-1,e=of(ag(a,hg));for(b=Yb(b,c,1);++d<a;)hg>d?e[d]=b(d):b(d);return e}function lf(a){var b=++Ff;return e(a)+b}function mf(a,b){return a+b}function nf(a,b,c){c&&Jc(a,b,c)&&(b=null);var d=Cc(),e=null==b;return d===pb&&e||(e=!1,b=d(b,c,3)),e?jb(fh(a)?a:Tc(a)):Rb(a,b)}p=p?Ya.defaults(Xa.Object(),p,Ya.pick(Xa,Ha)):Xa;var of=p.Array,pf=p.Date,qf=p.Error,rf=p.Function,sf=p.Math,tf=p.Number,uf=p.Object,vf=p.RegExp,wf=p.String,xf=p.TypeError,yf=of.prototype,zf=uf.prototype,Af=wf.prototype,Bf=(Bf=p.window)&&Bf.document,Cf=rf.prototype.toString,Df=Kb("length"),Ef=zf.hasOwnProperty,Ff=0,Gf=zf.toString,Hf=p._,If=vf("^"+Oe(Gf).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Jf=oe(Jf=p.ArrayBuffer)&&Jf,Kf=oe(Kf=Jf&&new Jf(0).slice)&&Kf,Lf=sf.ceil,Mf=p.clearTimeout,Nf=sf.floor,Of=oe(Of=uf.getPrototypeOf)&&Of,Pf=yf.push,Qf=zf.propertyIsEnumerable,Rf=oe(Rf=p.Set)&&Rf,Sf=p.setTimeout,Tf=yf.splice,Uf=oe(Uf=p.Uint8Array)&&Uf,Vf=oe(Vf=p.WeakMap)&&Vf,Wf=function(){try{var a=oe(a=p.Float64Array)&&a,b=new a(new Jf(10),0,1)&&a}catch(c){}return b}(),Xf=oe(Xf=of.isArray)&&Xf,Yf=oe(Yf=uf.create)&&Yf,Zf=p.isFinite,$f=oe($f=uf.keys)&&$f,_f=sf.max,ag=sf.min,bg=oe(bg=pf.now)&&bg,cg=oe(cg=tf.isFinite)&&cg,dg=p.parseInt,eg=sf.random,fg=tf.NEGATIVE_INFINITY,gg=tf.POSITIVE_INFINITY,hg=sf.pow(2,32)-1,ig=hg-1,jg=hg>>>1,kg=Wf?Wf.BYTES_PER_ELEMENT:0,lg=sf.pow(2,53)-1,mg=Vf&&new Vf,ng={},og=W.support={};!function(){og.funcDecomp=/\bthis\b/.test(function(){return this}),og.funcNames="string"==typeof rf.name;try{og.dom=11===Bf.createDocumentFragment().nodeType}catch(a){og.dom=!1}try{og.nonEnumArgs=!Qf.call(arguments,1)}catch(a){og.nonEnumArgs=!0}}(0,0),W.templateSettings={escape:sa,evaluate:ta,interpolate:ua,variable:"",imports:{_:W}};var pg=function(){function a(){}return function(b){if(le(b)){a.prototype=b;var c=new a;a.prototype=null}return c||p.Object()}}(),qg=cc(zb),rg=cc(Ab,!0),sg=dc(),tg=dc(!0),ug=mg?function(a,b){return mg.set(a,b),a}:af;Kf||(Zb=Jf&&Uf?function(a){var b=a.byteLength,c=Wf?Nf(b/kg):0,d=c*kg,e=new Jf(b);if(c){var f=new Wf(e,0,c);f.set(new Wf(a,0,c))}return b!=d&&(f=new Uf(e,d),f.set(new Uf(a,d))),e}:_e(null));var vg=Yf&&Rf?function(a){return new Va(a)}:_e(null),wg=mg?function(a){return mg.get(a)}:ff,xg=function(){return og.funcNames?"constant"==_e.name?Kb("name"):function(a){for(var b=a.name,c=ng[b],d=c?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}:_e("")}(),yg=function(){var a=0,b=0;return function(c,d){var e=Ug(),f=K-(e-b);if(b=e,f>0){if(++a>=J)return c}else a=0;return ug(c,d)}}(),zg=$d(function(a,b){return fh(a)||ee(a)?sb(a,xb(b,!1,!0)):[]}),Ag=kc(),Bg=kc(!0),Cg=$d(function(b,c){b||(b=[]),c=xb(c);var d=c.length,e=nb(b,c);for(c.sort(a);d--;){var f=parseFloat(c[d]);if(f!=g&&Ic(f)){var g=f;Tf.call(b,f,1)}}return e}),Dg=wc(),Eg=wc(!0),Fg=$d(function(a){return Sb(xb(a,!1,!0))}),Gg=$d(function(a,b){return fh(a)||ee(a)?sb(a,b):[]}),Hg=$d(sd),Ig=$d(function(a,b){var c=a?a.length:0;return Lc(c)&&(a=Tc(a)),nb(a,xb(b))}),Jg=ac(function(a,b,c){Ef.call(a,c)?++a[c]:a[c]=1}),Kg=jc(qg),Lg=jc(rg,!0),Mg=nc(_a,qg),Ng=nc(ab,rg),Og=ac(function(a,b,c){Ef.call(a,c)?a[c].push(b):a[c]=[b]}),Pg=ac(function(a,b,c){a[c]=b}),Qg=$d(function(a,b,c){var d=-1,e="function"==typeof b,f=a?a.length:0,g=Lc(f)?of(f):[];return qg(a,function(a){var f=e?b:null!=a&&a[b];g[++d]=f?f.apply(a,c):w}),g}),Rg=ac(function(a,b,c){a[c?0:1].push(b)},function(){return[[],[]]}),Sg=sc(gb,qg),Tg=sc(hb,rg),Ug=bg||function(){return(new pf).getTime()},Vg=$d(function(a,b,c){var d=y;if(c.length){var e=q(c,Vg.placeholder);d|=D}return xc(a,d,b,c,e)}),Wg=$d(function(a,b){b=b.length?xb(b):ye(a);for(var c=-1,d=b.length;++c<d;){var e=b[c];a[e]=xc(a[e],y,a)}return a}),Xg=$d(function(a,b,c){var d=y|z;if(c.length){var e=q(c,Xg.placeholder);d|=D}return xc(b,d,a,c,e)}),Yg=hc(B),Zg=hc(C),$g=$d(function(a,b){return rb(a,1,b)}),_g=$d(function(a,b,c){return rb(a,b,c)}),ah=mc(),bh=mc(!0),ch=rc(D),dh=rc(E),eh=$d(function(a,b){return xc(a,G,null,null,null,xb(b))}),fh=Xf||function(a){return o(a)&&Lc(a.length)&&Gf.call(a)==R};og.dom||(he=function(a){return!!a&&1===a.nodeType&&o(a)&&!ih(a)});var gh=cg||function(a){return"number"==typeof a&&Zf(a)},hh=d(/x/)||Uf&&!d(Uf)?function(a){return Gf.call(a)==V}:d,ih=Of?function(a){if(!a||Gf.call(a)!=Y)return!1;var b=a.valueOf,c=oe(b)&&(c=Of(b))&&Of(c);return c?a==c||Of(a)==c:Rc(a)}:Rc,jh=bc(mb),kh=$d(function(a){var b=a[0];return null==b?b:(a.push(kb),jh.apply(w,a))}),lh=lc(zb),mh=lc(Ab),nh=oc(sg),oh=oc(tg),ph=pc(zb),qh=pc(Ab),rh=$f?function(a){if(a)var b=a.constructor,c=a.length;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&c&&Lc(c)?Sc(a):le(a)?$f(a):[]}:Sc,sh=bc(Ib),th=$d(function(a,b){if(null==a)return{};if("function"!=typeof b[0]){var b=db(xb(b),wf);return Oc(a,sb(Be(a),b))}var c=Yb(b[0],b[1],3);return Pc(a,function(a,b,d){return!c(a,b,d)})}),uh=$d(function(a,b){return null==a?{}:"function"==typeof b[0]?Pc(a,Yb(b[0],b[1],3)):Oc(a,xb(b))}),vh=fc(function(a,b,c){return b=b.toLowerCase(),a+(c?b.charAt(0).toUpperCase()+b.slice(1):b)}),wh=fc(function(a,b,c){return a+(c?"-":"")+b.toLowerCase()}),xh=qc(),yh=qc(!0);8!=dg(Ga+"08")&&(Qe=function(a,b,c){return(c?Jc(a,b,c):null==b)?b=0:b&&(b=+b),a=Ue(a),dg(a,b||(ya.test(a)?16:10))});var zh=fc(function(a,b,c){return a+(c?"_":"")+b.toLowerCase()}),Ah=fc(function(a,b,c){return a+(c?" ":"")+(b.charAt(0).toUpperCase()+b.slice(1))}),Bh=$d(function(a,b){try{return a.apply(w,b)}catch(c){return ke(c)?c:new qf(c)}}),Ch=ic(eb),Dh=ic(fb,!0);return W.prototype=$.prototype,aa.prototype=pg($.prototype),aa.prototype.constructor=aa,Ma.prototype=pg($.prototype),Ma.prototype.constructor=Ma,Qa.prototype["delete"]=Ra,Qa.prototype.get=Sa,Qa.prototype.has=Ta,Qa.prototype.set=Ua,Va.prototype.push=Za,Xd.Cache=Qa,W.after=Td,W.ary=Ud,W.assign=jh,W.at=Ig,W.before=Vd,W.bind=Vg,W.bindAll=Wg,W.bindKey=Xg,W.callback=$e,W.chain=vd,W.chunk=Wc,W.compact=Xc,W.constant=_e,W.countBy=Jg,W.create=xe,W.curry=Yg,W.curryRight=Zg,W.debounce=Wd,W.defaults=kh,W.defer=$g,W.delay=_g,W.difference=zg,W.drop=Yc,W.dropRight=Zc,W.dropRightWhile=$c,W.dropWhile=_c,W.fill=ad,W.filter=Fd,W.flatten=cd,W.flattenDeep=dd,W.flow=ah,W.flowRight=bh,W.forEach=Mg,W.forEachRight=Ng,W.forIn=nh,W.forInRight=oh,W.forOwn=ph,W.forOwnRight=qh,W.functions=ye,W.groupBy=Og,W.indexBy=Pg,W.initial=fd,W.intersection=gd,W.invert=Ae,W.invoke=Qg,W.keys=rh,W.keysIn=Be,W.map=Id,W.mapValues=Ce,W.matches=bf,W.matchesProperty=cf,W.memoize=Xd,W.merge=sh,W.mixin=df,W.negate=Yd,W.omit=th,W.once=Zd,W.pairs=De,W.partial=ch,W.partialRight=dh,W.partition=Rg,W.pick=uh,W.pluck=Jd,W.property=gf,W.propertyOf=hf,W.pull=jd,W.pullAt=Cg,W.range=jf,W.rearg=eh,W.reject=Kd,W.remove=kd,W.rest=ld,W.restParam=$d,W.shuffle=Md,W.slice=md,W.sortBy=Pd,W.sortByAll=Qd,W.sortByOrder=Rd,W.spread=_d,W.take=nd,W.takeRight=od,W.takeRightWhile=pd,W.takeWhile=qd,W.tap=wd,W.throttle=ae,W.thru=xd,W.times=kf,W.toArray=ve,W.toPlainObject=we,W.transform=Fe,W.union=Fg,W.uniq=rd,W.unzip=sd,W.values=Ge,W.valuesIn=He,W.where=Sd,W.without=Gg,W.wrap=be,W.xor=td,W.zip=Hg,W.zipObject=ud,W.backflow=bh,W.collect=Id,W.compose=bh,W.each=Mg,W.eachRight=Ng,W.extend=jh,W.iteratee=$e,W.methods=ye,W.object=ud,W.select=Fd,W.tail=ld,W.unique=rd,df(W,W),W.add=mf,W.attempt=Bh,W.camelCase=vh,W.capitalize=Ke,W.clone=ce,W.cloneDeep=de,W.deburr=Le,W.endsWith=Me,W.escape=Ne,W.escapeRegExp=Oe,W.every=Ed,W.find=Kg,W.findIndex=Ag,W.findKey=lh,W.findLast=Lg,W.findLastIndex=Bg,W.findLastKey=mh,W.findWhere=Gd,W.first=bd,W.has=ze,W.identity=af,W.includes=Hd,W.indexOf=ed,W.inRange=Ie,W.isArguments=ee,W.isArray=fh,W.isBoolean=fe,W.isDate=ge,W.isElement=he,W.isEmpty=ie,W.isEqual=je,W.isError=ke,W.isFinite=gh,W.isFunction=hh,W.isMatch=me,W.isNaN=ne,W.isNative=oe,W.isNull=pe,W.isNumber=qe,W.isObject=le,W.isPlainObject=ih,W.isRegExp=re,W.isString=se,W.isTypedArray=te,W.isUndefined=ue,W.kebabCase=wh,W.last=hd,W.lastIndexOf=id,W.max=Ch,W.min=Dh,W.noConflict=ef,W.noop=ff,W.now=Ug,W.pad=Pe,W.padLeft=xh,W.padRight=yh,W.parseInt=Qe,W.random=Je,W.reduce=Sg,W.reduceRight=Tg,W.repeat=Re,W.result=Ee,W.runInContext=v,W.size=Nd,W.snakeCase=zh,W.some=Od,W.sortedIndex=Dg,W.sortedLastIndex=Eg,W.startCase=Ah,W.startsWith=Se,W.sum=nf,W.template=Te,W.trim=Ue,W.trimLeft=Ve,W.trimRight=We,W.trunc=Xe,W.unescape=Ye,W.uniqueId=lf,W.words=Ze,W.all=Ed,W.any=Od,W.contains=Hd,W.detect=Kg,W.foldl=Sg,W.foldr=Tg,W.head=bd,W.include=Hd,W.inject=Sg,df(W,function(){var a={};return zb(W,function(b,c){W.prototype[c]||(a[c]=b)}),a}(),!1),W.sample=Ld,W.prototype.sample=function(a){return this.__chain__||null!=a?this.thru(function(b){return Ld(b,a)}):Ld(this.value())},W.VERSION=x,_a(["bind","bindKey","curry","curryRight","partial","partialRight"],function(a){W[a].placeholder=W}),_a(["dropWhile","filter","map","takeWhile"],function(a,b){var c=b!=N,d=b==L;Ma.prototype[a]=function(a,e){var f=this.__filtered__,g=f&&d?new Ma(this):this.clone(),h=g.__iteratees__||(g.__iteratees__=[]);return h.push({done:!1,count:0,index:0,iteratee:Cc(a,e,1),limit:-1,type:b}),g.__filtered__=f||c,g}}),_a(["drop","take"],function(a,b){var c=a+"While";Ma.prototype[a]=function(c){var d=this.__filtered__,e=d&&!b?this.dropWhile():this.clone();if(c=null==c?1:_f(Nf(c)||0,0),d)b?e.__takeCount__=ag(e.__takeCount__,c):hd(e.__iteratees__).limit=c;else{var f=e.__views__||(e.__views__=[]);f.push({size:c,type:a+(e.__dir__<0?"Right":"")})}return e},Ma.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()},Ma.prototype[a+"RightWhile"]=function(a,b){return this.reverse()[c](a,b).reverse()}}),_a(["first","last"],function(a,b){var c="take"+(b?"Right":"");Ma.prototype[a]=function(){return this[c](1).value()[0]}}),_a(["initial","rest"],function(a,b){var c="drop"+(b?"":"Right");Ma.prototype[a]=function(){return this[c](1)}}),_a(["pluck","where"],function(a,b){var c=b?"filter":"map",d=b?Gb:Kb;Ma.prototype[a]=function(a){return this[c](d(a))}}),Ma.prototype.compact=function(){return this.filter(af)},Ma.prototype.reject=function(a,b){return a=Cc(a,b,1),this.filter(function(b){return!a(b)})},Ma.prototype.slice=function(a,b){a=null==a?0:+a||0;var c=0>a?this.takeRight(-a):this.drop(a);return"undefined"!=typeof b&&(b=+b||0,c=0>b?c.dropRight(-b):c.take(b-a)),c},Ma.prototype.toArray=function(){return this.drop(0)},zb(Ma.prototype,function(a,b){var c=W[b];if(c){var d=/^(?:filter|map|reject)|While$/.test(b),e=/^(?:first|last)$/.test(b);W.prototype[b]=function(){var b=arguments,f=(b.length,this.__chain__),g=this.__wrapped__,h=!!this.__actions__.length,i=g instanceof Ma,j=b[0],k=i||fh(g);k&&d&&"function"==typeof j&&1!=j.length&&(i=k=!1);var l=i&&!h;if(e&&!f)return l?a.call(g):c.call(W,this.value());var m=function(a){var d=[a];return Pf.apply(d,b),c.apply(W,d)};if(k){var n=l?g:new Ma(this),o=a.apply(n,b);if(!e&&(h||o.__actions__)){var p=o.__actions__||(o.__actions__=[]);p.push({func:xd,args:[m],thisArg:W})}return new aa(o,f)}return this.thru(m)}}}),_a(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(a){var b=(/^(?:replace|split)$/.test(a)?Af:yf)[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:join|pop|replace|shift)$/.test(a);W.prototype[a]=function(){var a=arguments;return d&&!this.__chain__?b.apply(this.value(),a):this[c](function(c){return b.apply(c,a)})}}),zb(Ma.prototype,function(a,b){var c=W[b];if(c){var d=c.name,e=ng[d]||(ng[d]=[]);e.push({name:b,func:c})}}),ng[tc(null,z).name]=[{name:"wrapper",func:null}],Ma.prototype.clone=Na,Ma.prototype.reverse=Oa,Ma.prototype.value=Pa,W.prototype.chain=yd,W.prototype.commit=zd,W.prototype.plant=Ad,W.prototype.reverse=Bd,W.prototype.toString=Cd,W.prototype.run=W.prototype.toJSON=W.prototype.valueOf=W.prototype.value=Dd,W.prototype.collect=W.prototype.map,W.prototype.head=W.prototype.first,W.prototype.select=W.prototype.filter,W.prototype.tail=W.prototype.rest,W}var w,x="3.6.0",y=1,z=2,A=4,B=8,C=16,D=32,E=64,F=128,G=256,H=30,I="...",J=150,K=16,L=0,M=1,N=2,O="Expected a function",P="__lodash_placeholder__",Q="[object Arguments]",R="[object Array]",S="[object Boolean]",T="[object Date]",U="[object Error]",V="[object Function]",W="[object Map]",X="[object Number]",Y="[object Object]",Z="[object RegExp]",$="[object Set]",_="[object String]",aa="[object WeakMap]",ba="[object ArrayBuffer]",ca="[object Float32Array]",da="[object Float64Array]",ea="[object Int8Array]",fa="[object Int16Array]",ga="[object Int32Array]",ha="[object Uint8Array]",ia="[object Uint8ClampedArray]",ja="[object Uint16Array]",ka="[object Uint32Array]",la=/\b__p \+= '';/g,ma=/\b(__p \+=) '' \+/g,na=/(__e\(.*?\)|\b__t\)) \+\n'';/g,oa=/&(?:amp|lt|gt|quot|#39|#96);/g,pa=/[&<>"'`]/g,qa=RegExp(oa.source),ra=RegExp(pa.source),sa=/<%-([\s\S]+?)%>/g,ta=/<%([\s\S]+?)%>/g,ua=/<%=([\s\S]+?)%>/g,va=/[\u0300-\u036f\ufe20-\ufe23]/g,wa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,xa=/\w*$/,ya=/^0[xX]/,za=/^\[object .+?Constructor\]$/,Aa=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ba=/($^)/,Ca=/[.*+?^${}()|[\]\/\\]/g,Da=RegExp(Ca.source),Ea=/['\n\r\u2028\u2029\\]/g,Fa=function(){var a="[A-Z\\xc0-\\xd6\\xd8-\\xde]",b="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(a+"+(?="+a+b+")|"+a+"?"+b+"|"+a+"+|[0-9]+","g")}(),Ga=" 	\f\n\r\u2028\u2029",Ha=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],Ia=-1,Ja={};Ja[ca]=Ja[da]=Ja[ea]=Ja[fa]=Ja[ga]=Ja[ha]=Ja[ia]=Ja[ja]=Ja[ka]=!0,Ja[Q]=Ja[R]=Ja[ba]=Ja[S]=Ja[T]=Ja[U]=Ja[V]=Ja[W]=Ja[X]=Ja[Y]=Ja[Z]=Ja[$]=Ja[_]=Ja[aa]=!1;var Ka={};Ka[Q]=Ka[R]=Ka[ba]=Ka[S]=Ka[T]=Ka[ca]=Ka[da]=Ka[ea]=Ka[fa]=Ka[ga]=Ka[X]=Ka[Y]=Ka[Z]=Ka[_]=Ka[ha]=Ka[ia]=Ka[ja]=Ka[ka]=!0,Ka[U]=Ka[V]=Ka[W]=Ka[$]=Ka[aa]=!1;var La={leading:!1,maxWait:0,trailing:!1},Ma={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},Na={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Oa={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Pa={"function":!0,object:!0},Qa={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ra=Pa[typeof exports]&&exports&&!exports.nodeType&&exports,Sa=Pa[typeof module]&&module&&!module.nodeType&&module,Ta=Ra&&Sa&&"object"==typeof global&&global,Ua=Pa[typeof self]&&self&&self.Object&&self,Va=Pa[typeof window]&&window&&window.Object&&window,Wa=Sa&&Sa.exports===Ra&&Ra,Xa=Ta||Va!==(this&&this.window)&&Va||Ua||this,Ya=v();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Xa._=Ya,define("lodash",[],function(){return Ya})):Ra&&Sa?Wa?(Sa.exports=Ya)._=Ya:Ra._=Ya:Xa._=Ya}.call(this),define("util",[],function(){var a=32,b=2;return{gridTileToScreen:function(c,d,e){return e=e||{x:0,y:0},e.x=e.x||0,e.y=e.y||0,d=d===!0||d===!1?d:!0,c.x=c.x*a+e.x*a,c.y=c.y*a+e.y*a,d&&1!==b?(c.scale.x=b,c.scale.y=b):1!==b&&(c.x+=a/2-c.width/2,c.y+=a/2-c.height/2),c},tileScale:2,tileSize:32}}),define("entity/entity",["../util"],function(a){function b(b,c,d,e){this.gameData=b,this.position=c,this.sprite=a.gridTileToScreen(d,!1,e),this.lightRange=0}return b.prototype={move:function(b){this.position.x+=b[0],this.position.y+=b[1],this.sprite.position.x+=a.tileSize*b[0],this.sprite.position.y+=a.tileSize*b[1]},act:function(){throw"Not implemented"},interact:function(){}},b}),define("entity/chest",["./entity"],function(a){function b(b,c){a.call(this,b,c,game.add.sprite(c.x,c.y,"tiles",414),{y:-.25})}return b.prototype=Object.create(a.prototype,{act:{value:function(){}},interact:{value:function(a){this.gameData.ananas===this.position.x+","+this.position.y?(alert("Hooray! You found an ananas and won this game."),this.gameData.engine.lock(),window.removeEventListener("keydown",a)):alert("This box is empty")}}}),b}),define("entity/pedro",["./entity"],function(b){function c(a,c){b.call(this,a,c,game.add.sprite(c.x,c.y,"mob"))}function d(b,c){function d(a,c){var d=a+","+c;return d in b.map&&b.map[d].walkable}function e(a,b){g.push([a,b])}var f=b.player.position,g=[],h=new a.Path.AStar(f.x,f.y,d,{topology:8});return h.compute(c.position.x,c.position.y,e),g}return c.prototype=Object.create(b.prototype,{act:{value:function(){var a=d(this.gameData,this);if(a.shift(),a.length<=1)this.gameData.engine.lock(),alert("Game over - you were captured by Pedro!");else{var b=[a[0][0]-this.position.x,a[0][1]-this.position.y];this.move(b)}}}}),c}),define("entity/player",["./entity"],function(b){function c(a,c){b.call(this,a,c,game.add.sprite(c.x,c.y,"boy"))}var d={38:0,33:1,39:2,34:3,40:4,35:5,37:6,36:7};return c.prototype=Object.create(b.prototype,{act:{value:function(){this.gameData.engine.lock(),window.addEventListener("keydown",this)}},handleEvent:{value:function(b){var c=b.keyCode;if(13===c||32===c){{this.position.x+","+this.position.y}for(var e in this.gameData.entities){var f=this.gameData.entities[e];f.position&&f.position.y===this.position.y&&f.position.x===this.position.x&&f.interact(this)}}if(c in d){var g=a.DIRS[8][d[c]],h=this.position.x+g[0],i=this.position.y+g[1],j=h+","+i;j in this.gameData.map&&this.gameData.map[j].walkable&&(this.move(g),window.removeEventListener("keydown",this),this.gameData.engine.unlock())}}}}),c}),define("entity/torch",["./entity"],function(a){function b(b,c){a.call(this,b,c,game.add.sprite(c.x,c.y,"tiles",417)),this.lightRange=5}return b.prototype=Object.create(a.prototype,{act:{value:function(){}}}),b}),define("entity",["./entity/chest","./entity/entity","./entity/pedro","./entity/player","./entity/torch"],function(a,b,c,d,e){return{Chest:a,Entity:b,Pedro:c,Player:d,Torch:e}}),define("tile/tile",["../util"],function(){function a(a,b,c){this.game=a,this.position=b,this.sprite=c,this.walkable=!1,this.seeThrough=!1}return a.prototype={},a}),define("tile/floor",["./tile"],function(a){function b(b,c,d,e){a.call(this,b,c,d.putTile(6,c.x,c.y,e)),this.walkable=!0,this.seeThrough=!0}return b.prototype=Object.create(a.prototype,{}),b}),define("tile/wall",["./tile"],function(a){function b(b,c,d,e){a.call(this,b,c,d.putTile(7,c.x,c.y,e))}return b.prototype=Object.create(a.prototype,{}),b}),define("tile",["./tile/floor","./tile/tile","./tile/wall"],function(a,b,c){return{Floor:a,Tile:b,Wall:c}}),define("lightPasses",[],function(){return function(a){return function(b,c){var d=b+","+c;return d in a&&a[d].seeThrough}}}),define("states/boot",["../entity","../tile","../lightPasses"],function(b,c,d){function e(d){function e(a,c){for(var d=0;10>d;d++){var e=g(a,b.Chest,c);e.sprite.alpha=0,a.entities.push(e),d||(a.ananas=e.position.x+","+e.position.y)}}function f(a,c){for(var d=0;10>d;d++)a.entities.push(g(a,b.Torch,c))}function g(b,c,d){var e=Math.floor(a.RNG.getUniform()*d.length),f=d.splice(e,1)[0],g=f.split(","),h=parseInt(g[0]),i=parseInt(g[1]);return new c(b,{x:h,y:i})}var h=game.add.tilemap();h.addTilesetImage("layer","tiles",16,16,0,1),j=h.create("main",50,37,16,16),j.scale.x=2,j.scale.y=2,j.resizeWorld();var i=new a.Map.Digger(50,37),k=[],l=function(a,b,e){if(!e){var f=a+","+b;k.push(f),d.map[f]=new c.Floor(game,{x:a,y:b},h,j),d.map[f].sprite.alpha=0}};i.create(l.bind(d));for(var m in d.map)for(var n=m.split(","),o=Number.parseInt(n[0]),p=Number.parseInt(n[1]),q=-1;2>q;q++)for(var r=-1;2>r;r++){var s=o+q,t=p+r;if(!d.map[s+","+t]){var u=s+","+t;d.map[u]=new c.Wall(game,{x:s,y:t},h,j),d.map[u].sprite.alpha=0}}f(d,k),e(d,k),d.player=g(d,b.Player,k),d.player.lightRange=3,d.entities.push(d.player),d.entities.push(g(d,b.Pedro,k))}function f(a,b){function c(a,c,e){var f=a+","+c;d.tiles.push(f),d.amount[f]=1-e/b.lightRange}var d={tiles:[],amount:{}};return b&&b.position?(a.shadowcaster.compute(b.position.x,b.position.y,b.lightRange,c),d):d}function g(a){for(var b=0;b<a.lit.length;b++){var c=a.lit[b];a.map[c]&&(a.map[c].sprite.alpha=0)}a.lit=[],a.lightStrength={};for(var d in a.entities)if(0!==a.entities[d].lightRange){var e=f(a,a.entities[d]);a.lit=a.lit.concat(e.tiles);for(var g in e.amount)a.lightStrength[g]||(a.lightStrength[g]=0),a.lightStrength[g]+=e.amount[g],a.lightStrength[g]>1&&(a.lightStrength[g]=1)}}function h(a,b){var c=[];return a.shadowcaster.compute(b.position.x,b.position.y,50,function(a,b){c.push(a+","+b)}),_.intersection(a.lit,c)}var i,j;return{init:function(){},preload:function(){game.load.image("boy","assets/jumping-boy.png"),game.load.image("mob","assets/monster-sprite.png"),game.load.spritesheet("tiles","assets/rlpack/Spritesheet/roguelikeSheet_transparent.png",16,16,-1,0,1)},create:function(){i={ananas:null,engine:null,lit:[],lightStrength:{},fovCache:{},map:{},entities:[],player:null,shadowcaster:null},e(i);var b=new a.Scheduler.Simple;for(var c in i.entities)i.entities[c]&&i.entities[c].act instanceof Function&&b.add(i.entities[c],!0);game.camera.follow(i.player.sprite),i.shadowcaster=new a.FOV.RecursiveShadowcasting(d(i.map)),i.engine=new a.Engine(b),i.engine.start()},update:function(){g(i);for(var a=h(i,i.player),b=0;b<a.length;b++){var c=a[b];i.map[c].sprite.alpha=i.lightStrength[c]}j.dirty=!0;for(var d in i.entities){var e=i.entities[d];if(!e||!e.position)return;var f=e.position.x+","+e.position.y;e.sprite.alpha=_.indexOf(a,f)>-1?i.lightStrength[f]:0}},render:function(){},paused:function(){},pausedUpdate:function(){},resize:function(){},shutdown:function(){}}}),define("states",["./states/boot"],function(a){game.state.add("boot",a)}),require(["config"],function(){"use strict";require(["rot","lodash"],function(){window.game=new Phaser.Game(800,600,Phaser.AUTO),require(["states"],function(){game.state.start("boot")})})}),define("game",function(){}),require(["game"])}();